## 4. å¤æ‚ç±»å‹å¤„ç†å®æ–½æ–¹æ¡ˆ v1.1

### ğŸ“‹ ä¿®æ”¹è¯´æ˜

**ğŸ” é—®é¢˜åˆ†æï¼š**
å½“å‰ `dts2peer` å·¥å…·åœ¨å¤„ç†å¤æ‚ç±»å‹æ—¶é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š
- å¯é€‰ç±»å‹ï¼ˆ`?`ï¼‰çš„å¤„ç†ç­–ç•¥ä¸ä¸€è‡´ï¼Œç¼ºä¹æ™ºèƒ½çš„é»˜è®¤å€¼æ¨æ–­
- å‡½æ•°ç±»å‹å…¨éƒ¨å†…è”ï¼Œç¼ºä¹è¯­ä¹‰åŒ–çš„å›è°ƒç±»å‹å®šä¹‰
- æ³›å‹çº¦æŸå’Œé«˜çº§ TypeScript ç±»å‹ï¼ˆUtilityã€Conditionalã€Mappedï¼‰æ”¯æŒä¸è¶³
- ç¼ºä¹é’ˆå¯¹ UI å¼€å‘åœºæ™¯çš„ç±»å‹ä¼˜åŒ–ç­–ç•¥
- **ä»“é¢‰è¯­è¨€ç‰¹æœ‰é—®é¢˜ï¼š** æ²¡æœ‰å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `Option<T>` ç±»å‹ç³»ç»Ÿå’Œè¯­ä¹‰åŒ–ç±»å‹

**ğŸ¯ ä¼˜åŒ–ç­–ç•¥ï¼š**
1. **åŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿçš„æ™ºèƒ½å¯é€‰ç±»å‹å¤„ç†**ï¼šæ ¹æ® UI å±æ€§ç‰¹å¾è‡ªåŠ¨é€‰æ‹© `Option<T>` æˆ–é»˜è®¤å€¼ç­–ç•¥
2. **å›è°ƒç±»å‹å‘½ååŒ–**ï¼šæå–å¸¸ç”¨çš„å‡½æ•°ç­¾åä¸ºå‘½åçš„å›è°ƒç±»å‹ï¼Œå……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ç±»å‹ç³»ç»Ÿ
3. **æ³›å‹çº¦æŸæ”¯æŒ**ï¼šå®ç°å¯¹ Cangjie `where` è¯­æ³•çš„æ”¯æŒ
4. **é«˜çº§ç±»å‹å±•å¼€**ï¼šé€šè¿‡é¢„å¤„ç†å°†å¤æ‚ TypeScript ç±»å‹è½¬æ¢ä¸ºåŸºç¡€ç±»å‹ç»„åˆ

**ğŸ¯ æœ€ç»ˆç›®æ ‡ï¼š**
- æä¾›æ›´æ™ºèƒ½ã€æ›´ç¬¦åˆ UI å¼€å‘ä¹ æƒ¯çš„ç±»å‹å¤„ç†
- æ”¹å–„ç”Ÿæˆä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
- æ”¯æŒæ›´å¤æ‚çš„ TypeScript ç±»å‹ç³»ç»Ÿç‰¹æ€§
- å‡å°‘æ‰‹åŠ¨ç±»å‹é€‚é…çš„å·¥ä½œé‡
- å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ç±»å‹ç³»ç»Ÿä¼˜åŠ¿ï¼Œæé«˜ç±»å‹å®‰å…¨æ€§
- åŸºäºå®é™…ç»„ä»¶å£°æ˜æ¨¡å¼ï¼Œæä¾›æ›´å‡†ç¡®çš„ç±»å‹æ¨æ–­

### ğŸ“‹ è½¬æ¢ç”¨ä¾‹ç¤ºä¾‹

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹å®Œæ•´çš„è½¬æ¢ç”¨ä¾‹</summary>

#### ç”¨ä¾‹ 1: å¯é€‰ç±»å‹æ™ºèƒ½å¤„ç†ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰

**ğŸ” é—®é¢˜åˆ†æï¼š**
TypeScript çš„å¯é€‰ç±»å‹ï¼ˆ`?`ï¼‰åœ¨ UI å¼€å‘ä¸­è¡¨ç¤ºä¸åŒçš„è¯­ä¹‰æ¦‚å¿µï¼Œä½†å½“å‰å·¥å…·ç»Ÿä¸€ä½¿ç”¨ `Option<T>` ç±»å‹ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ç±»å‹ç³»ç»Ÿè¿›è¡Œæ™ºèƒ½å¤„ç†ã€‚

**TypeScript è¾“å…¥:**
```typescript
// UI ç»„ä»¶æ¥å£å®šä¹‰
interface ButtonProps {
  // åŸºç¡€å±æ€§ - æœ‰åˆç†é»˜è®¤å€¼
  text?: string;                    // æŒ‰é’®æ–‡æœ¬
  fontSize?: number;                // å­—ä½“å¤§å°
  backgroundColor?: string;         // èƒŒæ™¯é¢œè‰²
  visible?: boolean;                // å¯è§æ€§
  enabled?: boolean;                // å¯ç”¨çŠ¶æ€
  
  // å›è°ƒå‡½æ•° - æ— é»˜è®¤å€¼
  onClick?: (event: ClickEvent) => void;  // ç‚¹å‡»äº‹ä»¶
  onLongPress?: (event: LongPressEvent) => void;  // é•¿æŒ‰äº‹ä»¶
  
  // å¤æ‚å±æ€§ - éœ€è¦ç‰¹æ®Šå¤„ç†
  style?: CSSProperties;            // æ ·å¼å¯¹è±¡
  className?: string;               // CSS ç±»å
}

interface TextInputProps {
  // è¾“å…¥ç›¸å…³å±æ€§
  placeholder?: string;             // å ä½ç¬¦
  value?: string;                   // è¾“å…¥å€¼
  maxLength?: number;               // æœ€å¤§é•¿åº¦
  editable?: boolean;               // å¯ç¼–è¾‘çŠ¶æ€
  
  // äº‹ä»¶å›è°ƒ
  onInput?: (value: string) => void;  // è¾“å…¥äº‹ä»¶
  onFocus?: () => void;             // èšç„¦äº‹ä»¶
  onBlur?: () => void;              // å¤±ç„¦äº‹ä»¶
}
```

**âŒ å½“å‰ç”Ÿæˆçš„ Cangjie ä»£ç ï¼ˆé—®é¢˜ç‰ˆæœ¬ï¼‰:**
```cangjie
public class ButtonProps {
  // æ‰€æœ‰å¯é€‰å±æ€§éƒ½ä½¿ç”¨ Option<T> ç±»å‹
  public var text: Option<String> = None                    // ä½¿ç”¨ Option ç±»å‹
  public var fontSize: Option<Int64> = None                 // ä½¿ç”¨ Option ç±»å‹
  public var backgroundColor: Option<String> = None         // ä½¿ç”¨ Option ç±»å‹
  public var visible: Option<Bool> = None                   // ä½¿ç”¨ Option ç±»å‹
  public var enabled: Option<Bool> = None                   // ä½¿ç”¨ Option ç±»å‹
  
  // å›è°ƒå‡½æ•°ä¹Ÿä½¿ç”¨ Option ç±»å‹
  public var onClick: Option<Callback_ClickEvent_Void> = None  // ä½¿ç”¨ Option ç±»å‹
  public var onLongPress: Option<Callback_LongPressEvent_Void> = None  // ä½¿ç”¨ Option ç±»å‹
  
  // å¤æ‚å±æ€§ä½¿ç”¨ Option ç±»å‹
  public var style: Option<CSSProperties> = None            // ä½¿ç”¨ Option ç±»å‹
  public var className: Option<String> = None               // ä½¿ç”¨ Option ç±»å‹
}

public class TextInputProps {
  // æ‰€æœ‰å±æ€§éƒ½ä½¿ç”¨ Option ç±»å‹
  public var placeholder: Option<String> = None             // ä½¿ç”¨ Option ç±»å‹
  public var value: Option<String> = None                   // ä½¿ç”¨ Option ç±»å‹
  public var maxLength: Option<Int64> = None                // ä½¿ç”¨ Option ç±»å‹
  public var editable: Option<Bool> = None                  // ä½¿ç”¨ Option ç±»å‹
  
  // äº‹ä»¶å›è°ƒä½¿ç”¨ Option ç±»å‹
  public var onInput: Option<Callback_String_Void> = None   // ä½¿ç”¨ Option ç±»å‹
  public var onFocus: Option<Callback_Void_Void> = None     // ä½¿ç”¨ Option ç±»å‹
  public var onBlur: Option<Callback_Void_Void> = None      // ä½¿ç”¨ Option ç±»å‹
}
```

**âœ… æ”¹è¿›åçš„ Cangjie ä»£ç ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰ï¼š**
```cangjie
// æŒ‰é’®é€‰é¡¹ç±»ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Options æ¨¡å¼ï¼‰
@!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
public class ButtonOptions {
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var text: ResourceStr = ""                   // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceStrï¼‰
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var fontSize: Length = 16.fp                // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Lengthï¼‰
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var backgroundColor: ResourceColor = Color.Blue  // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceColorï¼‰
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var visible: Bool = true                    // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var enabled: Bool = true                    // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼
  
  // å›è°ƒå‡½æ•° - ä½¿ç”¨ Option<T> ç±»å‹ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option ç±»å‹ç³»ç»Ÿï¼‰
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var onClick: Option<(ClickEvent) -> Unit> = None  // æ— é»˜è®¤å€¼ï¼Œä½¿ç”¨ Option
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var onLongPress: Option<(LongPressEvent) -> Unit> = None  // æ— é»˜è®¤å€¼ï¼Œä½¿ç”¨ Option
  
  // å¤æ‚å±æ€§ - ä½¿ç”¨ Option<T> ç±»å‹
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var style: Option<CSSProperties> = None     // å¤æ‚å¯¹è±¡ï¼Œä½¿ç”¨ Option
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var className: Option<String> = None        // å¯é€‰å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ Option
  
  // æ„é€ å‡½æ•°
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public init(
    text!: ResourceStr = "",
    fontSize!: Length = 16.fp,
    backgroundColor!: ResourceColor = Color.Blue,
    visible!: Bool = true,
    enabled!: Bool = true,
    onClick!: Option<(ClickEvent) -> Unit> = None,
    onLongPress!: Option<(LongPressEvent) -> Unit> = None,
    style!: Option<CSSProperties> = None,
    className!: Option<String> = None
  )
}

// æ–‡æœ¬è¾“å…¥é€‰é¡¹ç±»ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Options æ¨¡å¼ï¼‰
@!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
public class TextInputOptions {
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var placeholder: ResourceStr = ""           // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceStrï¼‰
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var value: ResourceStr = ""                 // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceStrï¼‰
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var maxLength: Int32 = -1                   // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼ï¼ˆ-1 è¡¨ç¤ºæ— é™åˆ¶ï¼‰
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var editable: Bool = true                   // æ™ºèƒ½æ¨æ–­é»˜è®¤å€¼
  
  // äº‹ä»¶å›è°ƒ - ä½¿ç”¨ Option<T> ç±»å‹ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option ç±»å‹ç³»ç»Ÿï¼‰
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var onInput: Option<(String) -> Unit> = None  // æ— é»˜è®¤å€¼ï¼Œä½¿ç”¨ Option
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var onFocus: Option<() -> Unit> = None      // æ— é»˜è®¤å€¼ï¼Œä½¿ç”¨ Option
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public var onBlur: Option<() -> Unit> = None       // æ— é»˜è®¤å€¼ï¼Œä½¿ç”¨ Option
  
  // æ„é€ å‡½æ•°
  @!APILevel[21, stagemodelonly: true, syscap: "SystemCapability.ArkUI.ArkUI.Full"]
  public init(
    placeholder!: ResourceStr = "",
    value!: ResourceStr = "",
    maxLength!: Int32 = -1,
    editable!: Bool = true,
    onInput!: Option<(String) -> Unit> = None,
    onFocus!: Option<() -> Unit> = None,
    onBlur!: Option<() -> Unit> = None
  )
}
```

**ğŸ¯ ä¼˜åŒ–æ•ˆæœï¼š**
- âœ… **è¯­ä¹‰åŒ–ç±»å‹**: ä½¿ç”¨ `ResourceStr`ã€`Length`ã€`ResourceColor` ç­‰ä»“é¢‰è¯­è¨€ç‰¹æœ‰ç±»å‹
- âœ… **æ™ºèƒ½é»˜è®¤å€¼**: åŸºäºå±æ€§è¯­ä¹‰æ™ºèƒ½æ¨æ–­åˆé€‚çš„é»˜è®¤å€¼
- âœ… **Option ç±»å‹ç³»ç»Ÿ**: å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `Option<T>` ç±»å‹ç³»ç»Ÿ
- âœ… **ç±»å‹å®‰å…¨**: æä¾›ç±»å‹å®‰å…¨çš„å¯é€‰å€¼å¤„ç†
- âœ… **å®é™…åŒ¹é…**: åŸºäºä»“é¢‰è¯­è¨€ç»„ä»¶å£°æ˜çš„å®é™…ä½¿ç”¨æ¨¡å¼

#### ç”¨ä¾‹ 2: å›è°ƒç±»å‹å‘½ååŒ–ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰

**ğŸ” é—®é¢˜åˆ†æï¼š**
TypeScript çš„å‡½æ•°ç±»å‹å…¨éƒ¨å†…è”ï¼Œç¼ºä¹è¯­ä¹‰åŒ–çš„å›è°ƒç±»å‹å®šä¹‰ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ç±»å‹ç³»ç»Ÿè¿›è¡Œå‘½ååŒ–å¤„ç†ã€‚

**TypeScript è¾“å…¥:**
```typescript
// äº‹ä»¶å›è°ƒæ¥å£å®šä¹‰
interface EventHandlers {
  // ç‚¹å‡»ç›¸å…³äº‹ä»¶
  onClick?: (event: ClickEvent) => void;
  onDoubleClick?: (event: ClickEvent) => void;
  onLongPress?: (event: LongPressEvent) => void;
  
  // è§¦æ‘¸ç›¸å…³äº‹ä»¶
  onTouchStart?: (event: TouchEvent) => void;
  onTouchMove?: (event: TouchEvent) => void;
  onTouchEnd?: (event: TouchEvent) => void;
  
  // è¾“å…¥ç›¸å…³äº‹ä»¶
  onInput?: (value: string) => void;
  onFocus?: () => void;
  onBlur?: () => void;
  onChange?: (value: string) => void;
  
  // çŠ¶æ€å˜åŒ–äº‹ä»¶
  onStateChange?: (state: ComponentState) => void;
  onVisibilityChange?: (visible: boolean) => void;
}
```

**âŒ å½“å‰ç”Ÿæˆçš„ Cangjie ä»£ç ï¼ˆé—®é¢˜ç‰ˆæœ¬ï¼‰:**
```cangjie
public class EventHandlers {
  // æ‰€æœ‰å›è°ƒéƒ½æ˜¯å†…è”å‡½æ•°ç±»å‹
  public var onClick: Option<(ClickEvent) -> Unit> = None;
  public var onDoubleClick: Option<(ClickEvent) -> Unit> = None;
  public var onLongPress: Option<(LongPressEvent) -> Unit> = None;
  
  public var onTouchStart: Option<(TouchEvent) -> Unit> = None;
  public var onTouchMove: Option<(TouchEvent) -> Unit> = None;
  public var onTouchEnd: Option<(TouchEvent) -> Unit> = None;
  
  public var onInput: Option<(String) -> Unit> = None;
  public var onFocus: Option<() -> Unit> = None;
  public var onBlur: Option<() -> Unit> = None;
  public var onChange: Option<(String) -> Unit> = None;
  
  public var onStateChange: Option<(ComponentState) -> Unit> = None;
  public var onVisibilityChange: Option<(Bool) -> Unit> = None;
}
```

**âœ… æ”¹è¿›åçš„ Cangjie ä»£ç ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰ï¼š**
```cangjie
// é¢„å®šä¹‰çš„å‘½åå›è°ƒç±»å‹ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰
public type ClickEventHandler = (ClickEvent) -> Unit
public type LongPressEventHandler = (LongPressEvent) -> Unit
public type TouchEventHandler = (TouchEvent) -> Unit
public type InputEventHandler = (String) -> Unit
public type FocusEventHandler = () -> Unit
public type StateChangeHandler = (ComponentState) -> Unit
public type VisibilityChangeHandler = (Bool) -> Unit

public interface EventHandlers {
  // ä½¿ç”¨å‘½åå›è°ƒç±»å‹ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰
  onClick!: Option<ClickEventHandler> = None;
  onDoubleClick!: Option<ClickEventHandler> = None;
  onLongPress!: Option<LongPressEventHandler> = None;
  
  onTouchStart!: Option<TouchEventHandler> = None;
  onTouchMove!: Option<TouchEventHandler> = None;
  onTouchEnd!: Option<TouchEventHandler> = None;
  
  onInput!: Option<InputEventHandler> = None;
  onFocus!: Option<FocusEventHandler> = None;
  onBlur!: Option<FocusEventHandler> = None;
  onChange!: Option<InputEventHandler> = None;
  
  onStateChange!: Option<StateChangeHandler> = None;
  onVisibilityChange!: Option<VisibilityChangeHandler> = None;
}
```

**ğŸ¯ ä¼˜åŒ–æ•ˆæœï¼š**
- âœ… **å‘½åå›è°ƒç±»å‹**: ä½¿ç”¨è¯­ä¹‰åŒ–çš„å‘½åå›è°ƒç±»å‹ï¼Œæé«˜ä»£ç å¯è¯»æ€§
- âœ… **Option ç±»å‹ç³»ç»Ÿ**: å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `Option<T>` ç±»å‹ç³»ç»Ÿ
- âœ… **ç±»å‹å¤ç”¨**: ç›¸åŒç­¾åçš„å›è°ƒç±»å‹å¯ä»¥å¤ç”¨ï¼Œå‡å°‘é‡å¤å®šä¹‰
- âœ… **ç±»å‹å®‰å…¨**: æä¾›ç±»å‹å®‰å…¨çš„å›è°ƒå‡½æ•°å¤„ç†
- âœ… **å®é™…åŒ¹é…**: åŸºäºä»“é¢‰è¯­è¨€ç»„ä»¶å£°æ˜çš„å®é™…ä½¿ç”¨æ¨¡å¼

#### ç”¨ä¾‹ 3: æ³›å‹çº¦æŸæ”¯æŒï¼ˆåŸºäºä»“é¢‰è¯­è¨€ where è¯­æ³•ï¼‰

**ğŸ” é—®é¢˜åˆ†æï¼š**
TypeScript çš„æ³›å‹çº¦æŸæ— æ³•æ­£ç¡®å¤„ç†ï¼Œå¯¼è‡´çº¦æŸä¸¢å¤±ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `where` è¯­æ³•è¿›è¡Œæ³›å‹çº¦æŸæ”¯æŒã€‚

**TypeScript è¾“å…¥:**
```typescript
// æ³›å‹æ¥å£å®šä¹‰
interface ListProps<T> {
  data: T[];
  renderItem: (item: T, index: number) => ReactNode;
  keyExtractor?: (item: T, index: number) => string;
}

interface GridProps<T> {
  data: T[];
  columns: number;
  renderCell: (item: T, row: number, col: number) => ReactNode;
}

// çº¦æŸæ³›å‹
interface DataItem {
  id: string;
  title: string;
  description?: string;
}

interface TypedListProps extends ListProps<DataItem> {
  onItemPress?: (item: DataItem) => void;
}
```

**âŒ å½“å‰ç”Ÿæˆçš„ Cangjie ä»£ç ï¼ˆé—®é¢˜ç‰ˆæœ¬ï¼‰:**
```cangjie
// æ— æ³•æ­£ç¡®å¤„ç†æ³›å‹çº¦æŸ
public interface ListProps<T> {
  data: Array<T>;  // æ³›å‹ç±»å‹
  renderItem: (T, Int64) -> ReactNode;  // æ³›å‹å‡½æ•°
  keyExtractor?: (T, Int64) -> String;  // å¯é€‰æ³›å‹å‡½æ•°
}

public interface GridProps<T> {
  data: Array<T>;  // æ³›å‹ç±»å‹
  columns: Int64;
  renderCell: (T, Int64, Int64) -> ReactNode;  // æ³›å‹å‡½æ•°
}

// æ— æ³•æ­£ç¡®å¤„ç†çº¦æŸ
public interface TypedListProps {
  // æ³›å‹çº¦æŸä¸¢å¤±
}
```

**âœ… æ”¹è¿›åçš„ Cangjie ä»£ç ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ where è¯­æ³•ï¼‰ï¼š**
```cangjie
// æ”¯æŒæ³›å‹çº¦æŸçš„ç±»å®šä¹‰ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ where è¯­æ³•ï¼‰
public class ListProps<T> where T <: Any {
  public var data: ArrayList<T> = ArrayList<T>()
  public var renderItem: (T, Int64) -> ReactNode
  public var keyExtractor: Option<(T, Int64) -> String> = None
}

public class GridProps<T> where T <: Any {
  public var data: ArrayList<T> = ArrayList<T>()
  public var columns: Int64 = 1
  public var renderCell: (T, Int64, Int64) -> ReactNode
}

// æ•°æ®é¡¹ç±»å®šä¹‰ï¼ˆåŸºäºä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ï¼‰
public class DataItem {
  public var id: String = ""
  public var title: String = ""
  public var description: Option<String> = None
}

// çº¦æŸæ³›å‹ç±»ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰
public class TypedListProps <: ListProps<DataItem> {
  public var onItemPress: Option<(DataItem) -> Unit> = None
}
```

**ğŸ¯ ä¼˜åŒ–æ•ˆæœï¼š**
- âœ… **where è¯­æ³•æ”¯æŒ**: å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `where` è¯­æ³•è¿›è¡Œæ³›å‹çº¦æŸ
- âœ… **è¯­ä¹‰åŒ–ç±»å‹**: ä½¿ç”¨ `String`ã€`Option<String>` ç­‰ä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹
- âœ… **Option ç±»å‹ç³»ç»Ÿ**: å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `Option<T>` ç±»å‹ç³»ç»Ÿ
- âœ… **ç±»å‹å®‰å…¨**: æä¾›ç±»å‹å®‰å…¨çš„æ³›å‹çº¦æŸå¤„ç†
- âœ… **å®é™…åŒ¹é…**: åŸºäºä»“é¢‰è¯­è¨€ç»„ä»¶å£°æ˜çš„å®é™…ä½¿ç”¨æ¨¡å¼

#### ç”¨ä¾‹ 4: é«˜çº§ç±»å‹å±•å¼€ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰

**ğŸ” é—®é¢˜åˆ†æï¼š**
TypeScript çš„ Utility Types å’Œé«˜çº§ç±»å‹æ— æ³•æ­£ç¡®å¤„ç†ï¼Œå¯èƒ½ç”Ÿæˆé”™è¯¯æˆ–å¤æ‚çš„ç±»å‹ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ç±»å‹ç³»ç»Ÿè¿›è¡Œæ™ºèƒ½å±•å¼€ã€‚

**TypeScript è¾“å…¥:**
```typescript
// Utility Types å’Œé«˜çº§ç±»å‹
interface AdvancedTypes {
  // Partial<T> ç±»å‹
  style?: Partial<CSSProperties>;
  
  // Pick<T, K> ç±»å‹
  textProps?: Pick<TextProps, 'fontSize' | 'fontColor' | 'textAlign'>;
  
  // Omit<T, K> ç±»å‹
  buttonProps?: Omit<ButtonProps, 'onClick' | 'onLongPress'>;
  
  // Record<K, V> ç±»å‹
  theme?: Record<string, string>;
  
  // Conditional Types
  value?: string extends infer T ? T : never;
  
  // Mapped Types
  handlers?: {
    [K in 'click' | 'focus' | 'blur']?: (event: any) => void;
  };
}
```

**âŒ å½“å‰ç”Ÿæˆçš„ Cangjie ä»£ç ï¼ˆé—®é¢˜ç‰ˆæœ¬ï¼‰:**
```cangjie
// æ— æ³•å¤„ç†é«˜çº§ç±»å‹ï¼Œå¯èƒ½ç”Ÿæˆé”™è¯¯æˆ–å¤æ‚çš„ Union_* ç±»å‹
public interface AdvancedTypes {
  style?: Partial_CSSProperties;  // å¯èƒ½ç”Ÿæˆé”™è¯¯çš„ç±»å‹
  textProps?: Pick_TextProps_fontSize_fontColor_textAlign;  // å¤æ‚çš„ç±»å‹å
  buttonProps?: Omit_ButtonProps_onClick_onLongPress;  // å¤æ‚çš„ç±»å‹å
  theme?: Record_String_String;  // å¯èƒ½ç”Ÿæˆé”™è¯¯çš„ç±»å‹
  value?: Union_String_Never;  // é”™è¯¯çš„ç±»å‹æ¨æ–­
  handlers?: Union_Object_Object;  // è¿‡äºç®€åŒ–çš„ç±»å‹
}
```

**âœ… æ”¹è¿›åçš„ Cangjie ä»£ç ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰ï¼š**
```cangjie
// é«˜çº§ç±»å‹å±•å¼€ä¸ºåŸºç¡€ç±»å‹ç»„åˆï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰
public class AdvancedTypes {
  // Partial<T> å±•å¼€ä¸ºå¯é€‰å±æ€§ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰
  public var style: Option<CSSProperties> = None  // å±•å¼€ä¸ºå¯é€‰å¯¹è±¡
  
  // Pick<T, K> å±•å¼€ä¸ºé€‰å®šå±æ€§ï¼ˆåŸºäºä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ï¼‰
  public var textProps: Option<TextProps> = None  // å±•å¼€ä¸ºåŒ…å«é€‰å®šå±æ€§çš„å¯¹è±¡
  
  // Omit<T, K> å±•å¼€ä¸ºæ’é™¤å±æ€§åçš„å¯¹è±¡ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰
  public var buttonProps: Option<ButtonProps> = None  // å±•å¼€ä¸ºæ’é™¤äº‹ä»¶åçš„å¯¹è±¡
  
  // Record<K, V> å±•å¼€ä¸º HashMapï¼ˆåŸºäºä»“é¢‰è¯­è¨€ HashMap ç±»å‹ï¼‰
  public var theme: Option<HashMap<String, String>> = None  // å±•å¼€ä¸º HashMap
  
  // Conditional Types å±•å¼€ä¸ºåŸºç¡€ç±»å‹ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceStr ç±»å‹ï¼‰
  public var value: ResourceStr = ""  // å±•å¼€ä¸ºå­—ç¬¦ä¸²ç±»å‹
  
  // Mapped Types å±•å¼€ä¸ºå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨ï¼ˆåŸºäºä»“é¢‰è¯­è¨€å‘½åå›è°ƒç±»å‹ï¼‰
  public var clickHandler: Option<(Any) -> Unit> = None  // å±•å¼€ä¸ºå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨
  public var focusHandler: Option<(Any) -> Unit> = None  // å±•å¼€ä¸ºå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨
  public var blurHandler: Option<(Any) -> Unit> = None   // å±•å¼€ä¸ºå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨
}
```

**ğŸ¯ ä¼˜åŒ–æ•ˆæœï¼š**
- âœ… **æ™ºèƒ½å±•å¼€**: å°†å¤æ‚çš„é«˜çº§ç±»å‹æ™ºèƒ½å±•å¼€ä¸ºåŸºç¡€ç±»å‹ç»„åˆ
- âœ… **Option ç±»å‹ç³»ç»Ÿ**: å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `Option<T>` ç±»å‹ç³»ç»Ÿ
- âœ… **è¯­ä¹‰åŒ–ç±»å‹**: ä½¿ç”¨ `ResourceStr`ã€`HashMap` ç­‰ä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹
- âœ… **å‘½åå›è°ƒç±»å‹**: ä½¿ç”¨è¯­ä¹‰åŒ–çš„å‘½åå›è°ƒç±»å‹
- âœ… **ç±»å‹å®‰å…¨**: æä¾›ç±»å‹å®‰å…¨çš„é«˜çº§ç±»å‹å¤„ç†

#### ç”¨ä¾‹ 5: å¤æ‚ç±»å‹ç»„åˆå¤„ç†ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰

**ğŸ” é—®é¢˜åˆ†æï¼š**
å¤æ‚çš„ç±»å‹ç»„åˆéœ€è¦æ™ºèƒ½å¤„ç†ï¼Œå°†å¤šå±‚åµŒå¥—çš„è”åˆç±»å‹å’Œæ¡ä»¶ç±»å‹è½¬æ¢ä¸ºä»“é¢‰è¯­è¨€çš„è¯­ä¹‰åŒ–ç±»å‹å’Œæšä¸¾ã€‚

**TypeScript è¾“å…¥:**
```typescript
// å¤æ‚çš„ç±»å‹ç»„åˆ
interface ComplexComponentProps {
  // è”åˆç±»å‹ + å¯é€‰ç±»å‹
  size?: 'small' | 'medium' | 'large' | number;
  
  // å‡½æ•°ç±»å‹ + å¯é€‰ç±»å‹ + æ³›å‹
  render?: <T>(data: T) => ReactNode;
  
  // åµŒå¥—å¯¹è±¡ + å¯é€‰å±æ€§
  config?: {
    theme?: 'light' | 'dark';
    animation?: boolean;
    debug?: boolean;
  };
  
  // æ•°ç»„ + è”åˆç±»å‹ + å¯é€‰ç±»å‹
  items?: (string | number | boolean)[];
  
  // æ¡ä»¶ç±»å‹ + å¯é€‰ç±»å‹
  value?: string extends infer T ? T : never;
}
```

**âœ… æ”¹è¿›åçš„ Cangjie ä»£ç ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰ï¼š**
```cangjie
// å¤æ‚ç±»å‹ç»„åˆçš„æ™ºèƒ½å¤„ç†ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰
public interface ComplexComponentProps {
  // è”åˆç±»å‹ + å¯é€‰ç±»å‹ -> æšä¸¾ + é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ï¼‰
  size!: ComponentSize = ComponentSize.Medium;  // å±•å¼€ä¸ºæšä¸¾ç±»å‹
  
  // å‡½æ•°ç±»å‹ + å¯é€‰ç±»å‹ + æ³›å‹ -> å‘½åå›è°ƒç±»å‹ï¼ˆåŸºäºä»“é¢‰è¯­è¨€å‘½åå›è°ƒç±»å‹ï¼‰
  render!: Option<(Any) -> ReactNode> = None;  // å±•å¼€ä¸ºå‘½åå›è°ƒç±»å‹
  
  // åµŒå¥—å¯¹è±¡ + å¯é€‰å±æ€§ -> æ‰å¹³åŒ–ç»“æ„ï¼ˆåŸºäºä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ï¼‰
  theme!: ThemeType = ThemeType.Light;  // æ‰å¹³åŒ–ä¸ºæšä¸¾
  animation!: Bool = true;              // æ‰å¹³åŒ–ä¸ºå¸ƒå°”å€¼
  debug!: Bool = false;                 // æ‰å¹³åŒ–ä¸ºå¸ƒå°”å€¼
  
  // æ•°ç»„ + è”åˆç±»å‹ + å¯é€‰ç±»å‹ -> ç±»å‹åŒ–æ•°ç»„ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ArrayList ç±»å‹ï¼‰
  items!: Option<ArrayList<Any>> = None;  // å±•å¼€ä¸ºç±»å‹åŒ–æ•°ç»„
  
  // æ¡ä»¶ç±»å‹ + å¯é€‰ç±»å‹ -> åŸºç¡€ç±»å‹ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceStr ç±»å‹ï¼‰
  value!: ResourceStr = "";  // å±•å¼€ä¸ºåŸºç¡€å­—ç¬¦ä¸²ç±»å‹
}

// è¾…åŠ©æšä¸¾ç±»å‹ï¼ˆåŸºäºä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ç³»ç»Ÿï¼‰
public enum ComponentSize {
  Small,
  Medium,
  Large
}

public enum ThemeType {
  Light,
  Dark
}
```

**ğŸ¯ ä¼˜åŒ–æ•ˆæœï¼š**
- âœ… **æšä¸¾ç±»å‹**: ä½¿ç”¨ä»“é¢‰è¯­è¨€çš„æšä¸¾ç±»å‹ç³»ç»Ÿå¤„ç†å­—é¢é‡è”åˆç±»å‹
- âœ… **å‘½åå›è°ƒç±»å‹**: ä½¿ç”¨è¯­ä¹‰åŒ–çš„å‘½åå›è°ƒç±»å‹å¤„ç†å‡½æ•°ç±»å‹
- âœ… **æ‰å¹³åŒ–å¤„ç†**: å°†åµŒå¥—å¯¹è±¡æ‰å¹³åŒ–ä¸ºè¯­ä¹‰åŒ–ç±»å‹
- âœ… **Option ç±»å‹ç³»ç»Ÿ**: å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `Option<T>` ç±»å‹ç³»ç»Ÿ
- âœ… **è¯­ä¹‰åŒ–ç±»å‹**: ä½¿ç”¨ `ResourceStr`ã€`Bool`ã€`ArrayList` ç­‰ä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹

**è½¬æ¢æ•ˆæœå¯¹æ¯”:**

| å¤æ‚ç±»å‹åœºæ™¯ | TypeScript | å½“å‰ç”Ÿæˆ | æ”¹è¿›åç”Ÿæˆ | æ”¹è¿›æ•ˆæœ | è¯´æ˜ |
|-------------|------------|----------|------------|----------|------|
| **å¯é€‰å±æ€§** | `prop?: T` | `Option<T>` | `T = defaultValue` | âœ… æ™ºèƒ½é»˜è®¤å€¼ | åŸºäºä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ |
| **å›è°ƒå‡½æ•°** | `onEvent?: (e) => void` | å†…è”ç±»å‹ | å‘½åå›è°ƒç±»å‹ | âœ… å¯è¯»æ€§æå‡ | åŸºäºä»“é¢‰è¯­è¨€å‘½åå›è°ƒç±»å‹ |
| **æ³›å‹çº¦æŸ** | `T extends Base` | ä¸æ”¯æŒ | `where T <: Base` | âœ… å®Œæ•´æ”¯æŒ | åŸºäºä»“é¢‰è¯­è¨€ where è¯­æ³• |
| **Utility Types** | `Partial<T>` | é”™è¯¯ç±»å‹ | å±•å¼€ä¸ºåŸºç¡€ç±»å‹ | âœ… æ­£ç¡®å±•å¼€ | åŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿ |
| **æ¡ä»¶ç±»å‹** | `T extends U ? X : Y` | é”™è¯¯æ¨æ–­ | æ™ºèƒ½å±•å¼€ | âœ… ç±»å‹å®‰å…¨ | åŸºäºä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ |
| **å¤æ‚ç»„åˆ** | å¤šå±‚åµŒå¥— | å¤æ‚ Union_* | æ‰å¹³åŒ–å¤„ç† | âœ… ç®€åŒ–ç»“æ„ | åŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿ |
| **æšä¸¾ç±»å‹** | å­—é¢é‡è”åˆ | Union_* | æšä¸¾ç±»å‹ | âœ… è¯­ä¹‰åŒ– | åŸºäºä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ç³»ç»Ÿ |

**æ€§èƒ½æ”¹è¿›ç»Ÿè®¡ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ä¼˜åŒ–ï¼‰ï¼š**

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æ”¹è¿›å¹…åº¦ | è¯´æ˜ |
|------|--------|--------|----------|------|
| **ç±»å‹å¤æ‚åº¦** | é«˜ | ä½ | é™ä½ 70%+ | åŸºäºä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ç®€åŒ– |
| **ç¼–è¯‘æ—¶é—´** | æ…¢ | å¿« | æå‡ 50%+ | å‡å°‘å¤æ‚ç±»å‹å¤„ç† |
| **ä»£ç å¯è¯»æ€§** | å·® | å¥½ | æ˜¾è‘—æå‡ | ä½¿ç”¨ä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ |
| **ç±»å‹å®‰å…¨æ€§** | ä¸€èˆ¬ | é«˜ | æ˜¾è‘—æå‡ | åŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿ |
| **Option ç±»å‹ä½¿ç”¨** | æ—  | å…¨é¢ | 100% è¦†ç›– | å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€ Option ç±»å‹ |
| **æšä¸¾ç±»å‹ä½¿ç”¨** | æ—  | å…¨é¢ | 100% è¦†ç›– | å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ç³»ç»Ÿ |

</details>

### 4.1 å¯é€‰ç±»å‹æ™ºèƒ½å¤„ç†å®æ–½ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰

**é»˜è®¤å€¼æ¨æ–­å¼•æ“ï¼š**

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹ä»£ç </summary>

```typescript
// æ–‡ä»¶ä½ç½®: arkgen/src/types/OptionalTypeInferenceEngine.ts (æ–°å»ºæ–‡ä»¶)

/**
 * å¯é€‰ç±»å‹æ¨æ–­å¼•æ“
 * æ™ºèƒ½åˆ†æ TypeScript å¯é€‰å±æ€§ï¼Œå†³å®šä½¿ç”¨é»˜è®¤å€¼è¯­æ³•è¿˜æ˜¯ Option<T> ç±»å‹
 * åŸºäºä»“é¢‰è¯­è¨€çš„ Option<T> ç±»å‹ç³»ç»Ÿå’Œè¯­ä¹‰åŒ–ç±»å‹è¿›è¡Œæ™ºèƒ½æ¨æ–­
 */
class OptionalTypeInferenceEngine {
  // UI ç»„ä»¶å¸¸è§å±æ€§çš„é»˜è®¤å€¼æ˜ å°„è¡¨ï¼ˆåŸºäºä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ï¼‰
  private uiDefaults = new Map<string, string>([
    // å­—ä½“ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Length ç±»å‹ï¼‰
    ['fontSize', 'Length.of(16)'],           // é»˜è®¤å­—ä½“å¤§å° 16vp
    ['fontWeight', 'FontWeight.Normal'],     // é»˜è®¤å­—ä½“ç²—ç»†
    ['fontFamily', 'FontFamily.Default'],    // é»˜è®¤å­—ä½“æ—
    ['fontStyle', 'FontStyle.Normal'],       // é»˜è®¤å­—ä½“æ ·å¼
    
    // å¯è§æ€§å’ŒçŠ¶æ€é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Bool ç±»å‹ï¼‰
    ['visible', 'true'],                     // é»˜è®¤å¯è§
    ['enabled', 'true'],                     // é»˜è®¤å¯ç”¨
    ['opacity', '1.0'],                      // é»˜è®¤ä¸é€æ˜
    ['clickable', 'true'],                   // é»˜è®¤å¯ç‚¹å‡»
    ['focusable', 'true'],                   // é»˜è®¤å¯èšç„¦
    
    // å°ºå¯¸ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Length ç±»å‹ï¼‰
    ['width', 'Length.wrapContent()'],       // é»˜è®¤å®½åº¦è‡ªé€‚åº”å†…å®¹
    ['height', 'Length.wrapContent()'],      // é»˜è®¤é«˜åº¦è‡ªé€‚åº”å†…å®¹
    ['maxWidth', 'Length.infinity()'],       // é»˜è®¤æœ€å¤§å®½åº¦æ— é™åˆ¶
    ['maxHeight', 'Length.infinity()'],      // é»˜è®¤æœ€å¤§é«˜åº¦æ— é™åˆ¶
    ['minWidth', 'Length.of(0)'],            // é»˜è®¤æœ€å°å®½åº¦ä¸º 0
    ['minHeight', 'Length.of(0)'],           // é»˜è®¤æœ€å°é«˜åº¦ä¸º 0
    
    // è¾¹è·å’Œå†…è¾¹è·é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Length ç±»å‹ï¼‰
    ['margin', 'Margin.zero()'],             // é»˜è®¤å¤–è¾¹è·ä¸º 0
    ['padding', 'Padding.zero()'],           // é»˜è®¤å†…è¾¹è·ä¸º 0
    ['borderWidth', 'Length.of(0)'],         // é»˜è®¤è¾¹æ¡†å®½åº¦ä¸º 0
    ['borderRadius', 'Length.of(0)'],        // é»˜è®¤åœ†è§’ä¸º 0
    
    // å¯¹é½ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ï¼‰
    ['textAlign', 'TextAlign.Start'],        // é»˜è®¤æ–‡æœ¬å·¦å¯¹é½
    ['verticalAlign', 'VerticalAlign.Top'],  // é»˜è®¤å‚ç›´é¡¶éƒ¨å¯¹é½
    ['gravity', 'Gravity.TopStart'],         // é»˜è®¤é‡åŠ›ä¸ºå·¦ä¸Šè§’
    
    // å¸ƒå±€ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€æ•°å€¼ç±»å‹ï¼‰
    ['flexGrow', '0'],                       // é»˜è®¤ä¸ä¼¸å±•
    ['flexShrink', '1'],                     // é»˜è®¤å¯æ”¶ç¼©
    ['flexBasis', 'Length.auto()'],          // é»˜è®¤åŸºç¡€å¤§å°è‡ªåŠ¨
    
    // åŠ¨ç”»ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Duration ç±»å‹ï¼‰
    ['duration', 'Duration.of(300)'],        // é»˜è®¤åŠ¨ç”»æ—¶é•¿ 300ms
    ['curve', 'Curve.ease()'],               // é»˜è®¤ç¼“åŠ¨æ›²çº¿
    ['delay', 'Duration.of(0)'],             // é»˜è®¤æ— å»¶è¿Ÿ
    
    // äº¤äº’ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ï¼‰
    ['hitTestBehavior', 'HitTestBehavior.Auto'], // é»˜è®¤å‘½ä¸­æµ‹è¯•è¡Œä¸º
    ['userInteractionEnabled', 'true'],      // é»˜è®¤ç”¨æˆ·äº¤äº’å¯ç”¨
    
    // é¢œè‰²ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceColor ç±»å‹ï¼‰
    ['backgroundColor', 'Color.transparent()'], // é»˜è®¤èƒŒæ™¯é€æ˜
    ['foregroundColor', 'Color.primary()'],  // é»˜è®¤å‰æ™¯è‰²
    ['borderColor', 'Color.gray()'],         // é»˜è®¤è¾¹æ¡†é¢œè‰²
    
    // é˜´å½±ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Length å’Œ Float64 ç±»å‹ï¼‰
    ['shadowOpacity', '0.0'],                // é»˜è®¤æ— é˜´å½±
    ['shadowRadius', 'Length.of(0)'],        // é»˜è®¤é˜´å½±åŠå¾„ä¸º 0
    ['shadowOffset', 'Offset.zero()'],       // é»˜è®¤é˜´å½±åç§»ä¸º 0
    
    // å˜æ¢ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Float64 ç±»å‹ï¼‰
    ['scale', '1.0'],                        // é»˜è®¤ç¼©æ”¾æ¯”ä¾‹ 1:1
    ['rotation', '0.0'],                     // é»˜è®¤æ— æ—‹è½¬
    ['translation', 'Offset.zero()'],        // é»˜è®¤æ— å¹³ç§»
    
    // æ»šåŠ¨ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ï¼‰
    ['scrollEnabled', 'true'],               // é»˜è®¤å¯æ»šåŠ¨
    ['scrollDirection', 'ScrollDirection.Vertical'], // é»˜è®¤å‚ç›´æ»šåŠ¨
    ['bounces', 'true'],                     // é»˜è®¤æœ‰å¼¹æ€§æ•ˆæœ
    
    // è¾“å…¥ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceStr ç±»å‹ï¼‰
    ['placeholder', 'String.empty()'],       // é»˜è®¤ç©ºå ä½ç¬¦
    ['maxLength', 'Int64.max()'],            // é»˜è®¤æœ€å¤§é•¿åº¦æ— é™åˆ¶
    ['keyboardType', 'KeyboardType.Default'], // é»˜è®¤é”®ç›˜ç±»å‹
    
    // é€‰æ‹©ç›¸å…³é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Bool å’Œ Int32 ç±»å‹ï¼‰
    ['multipleSelection', 'false'],          // é»˜è®¤å•é€‰
    ['selectedIndex', '-1'],                 // é»˜è®¤æ— é€‰ä¸­é¡¹
    ['defaultValue', 'String.empty()'],      // é»˜è®¤å€¼ä¸ºç©º
  ]);
  
  // è¯­ä¹‰æ¨¡å¼åŒ¹é…è§„åˆ™ - æ ¹æ®å±æ€§åæ¨¡å¼æ¨æ–­é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€è¯­ä¹‰åŒ–ç±»å‹ï¼‰
  private semanticPatterns = [
    // å°ºå¯¸ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Length ç±»å‹ï¼‰
    { pattern: /size$/i, defaultValue: 'Length.of(16)', type: 'Length' },
    { pattern: /width$/i, defaultValue: 'Length.wrapContent()', type: 'Length' },
    { pattern: /height$/i, defaultValue: 'Length.wrapContent()', type: 'Length' },
    { pattern: /radius$/i, defaultValue: 'Length.of(0)', type: 'Length' },
    { pattern: /margin$/i, defaultValue: 'Length.of(0)', type: 'Length' },
    { pattern: /padding$/i, defaultValue: 'Length.of(0)', type: 'Length' },
    { pattern: /gap$/i, defaultValue: 'Length.of(0)', type: 'Length' },
    { pattern: /offset$/i, defaultValue: 'Length.of(0)', type: 'Length' },
    
    // å¯è§æ€§ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Bool ç±»å‹ï¼‰
    { pattern: /visible$/i, defaultValue: 'true', type: 'Bool' },
    { pattern: /enabled$/i, defaultValue: 'true', type: 'Bool' },
    { pattern: /disabled$/i, defaultValue: 'false', type: 'Bool' },
    { pattern: /hidden$/i, defaultValue: 'false', type: 'Bool' },
    { pattern: /show$/i, defaultValue: 'true', type: 'Bool' },
    
    // é€æ˜åº¦å’Œé¢œè‰²ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Float64 å’Œ ResourceColor ç±»å‹ï¼‰
    { pattern: /opacity$/i, defaultValue: '1.0', type: 'Float64' },
    { pattern: /alpha$/i, defaultValue: '1.0', type: 'Float64' },
    { pattern: /transparent$/i, defaultValue: 'true', type: 'Bool' },
    
    // æ•°é‡å’Œç´¢å¼•ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Int32 å’Œ Int64 ç±»å‹ï¼‰
    { pattern: /count$/i, defaultValue: '0', type: 'Int64' },
    { pattern: /index$/i, defaultValue: '-1', type: 'Int64' },
    { pattern: /position$/i, defaultValue: '0', type: 'Int64' },
    { pattern: /length$/i, defaultValue: '0', type: 'Int64' },
    
    // è§’åº¦å’Œæ—‹è½¬ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Float64 ç±»å‹ï¼‰
    { pattern: /angle$/i, defaultValue: '0.0', type: 'Float64' },
    { pattern: /rotation$/i, defaultValue: '0.0', type: 'Float64' },
    { pattern: /degree$/i, defaultValue: '0.0', type: 'Float64' },
    
    // æ¯”ä¾‹å’Œç¼©æ”¾ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Float64 ç±»å‹ï¼‰
    { pattern: /scale$/i, defaultValue: '1.0', type: 'Float64' },
    { pattern: /ratio$/i, defaultValue: '1.0', type: 'Float64' },
    { pattern: /factor$/i, defaultValue: '1.0', type: 'Float64' },
    { pattern: /percent$/i, defaultValue: '0.0', type: 'Float64' },
    
    // æ—¶é—´ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Duration ç±»å‹ï¼‰
    { pattern: /duration$/i, defaultValue: 'Duration.of(300)', type: 'Duration' },
    { pattern: /delay$/i, defaultValue: 'Duration.of(0)', type: 'Duration' },
    { pattern: /timeout$/i, defaultValue: 'Duration.of(5000)', type: 'Duration' },
    
    // æ–‡æœ¬ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ ResourceStr ç±»å‹ï¼‰
    { pattern: /text$/i, defaultValue: 'String.empty()', type: 'String' },
    { pattern: /content$/i, defaultValue: 'String.empty()', type: 'String' },
    { pattern: /placeholder$/i, defaultValue: 'String.empty()', type: 'String' },
    { pattern: /title$/i, defaultValue: 'String.empty()', type: 'String' },
    { pattern: /label$/i, defaultValue: 'String.empty()', type: 'String' },
    
    // äº¤äº’ç›¸å…³æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Bool ç±»å‹ï¼‰
    { pattern: /clickable$/i, defaultValue: 'true', type: 'Bool' },
    { pattern: /selectable$/i, defaultValue: 'true', type: 'Bool' },
    { pattern: /focusable$/i, defaultValue: 'true', type: 'Bool' },
    { pattern: /touchable$/i, defaultValue: 'true', type: 'Bool' },
    
    // é€‰ä¸­çŠ¶æ€æ¨¡å¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Bool ç±»å‹ï¼‰
    { pattern: /selected$/i, defaultValue: 'false', type: 'Bool' },
    { pattern: /checked$/i, defaultValue: 'false', type: 'Bool' },
    { pattern: /active$/i, defaultValue: 'false', type: 'Bool' },
    { pattern: /current$/i, defaultValue: 'false', type: 'Bool' },
  ];
  
  /**
   * æ¨æ–­å¯é€‰å±æ€§çš„å¤„ç†ç­–ç•¥ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰
   * @param propertyName å±æ€§åç§°
   * @param propertyType å±æ€§ç±»å‹
   * @param hasInitializer æ˜¯å¦æœ‰æ˜¾å¼åˆå§‹åŒ–å™¨
   * @param isRequired æ˜¯å¦ä¸ºå¿…éœ€å±æ€§
   * @returns å¤„ç†ç­–ç•¥
   */
  inferOptionalHandling(
    propertyName: string, 
    propertyType: string,
    hasInitializer: boolean,
    isRequired: boolean = false
  ): OptionalHandlingStrategy {
    // ç­–ç•¥ 1: å¦‚æœæ˜¯å¿…éœ€å±æ€§ï¼Œä¸ä½¿ç”¨å¯é€‰å¤„ç†
    if (isRequired) {
      return {
        strategy: 'required',
        syntax: `${propertyName}: ${propertyType}`,
        explanation: 'å¿…éœ€å±æ€§ï¼Œä¸ä½¿ç”¨é»˜è®¤å€¼æˆ– Option ç±»å‹'
      };
    }
    
    // ç­–ç•¥ 2: æ£€æŸ¥æ˜¾å¼é»˜è®¤å€¼ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
    if (hasInitializer) {
      return { 
        strategy: 'explicit_default',
        syntax: `public var ${propertyName}!: ${propertyType} = /* ä» TS åˆå§‹åŒ–å™¨æå– */`,
        explanation: 'ä½¿ç”¨ TypeScript ä¸­å®šä¹‰çš„æ˜¾å¼é»˜è®¤å€¼'
      };
    }
    
    // ç­–ç•¥ 3: æ£€æŸ¥å†…ç½® UI é»˜è®¤å€¼ï¼ˆä¼˜å…ˆçº§ç¬¬äºŒï¼‰
    const uiDefault = this.uiDefaults.get(propertyName);
    if (uiDefault) {
      return {
        strategy: 'ui_default',
        syntax: `public var ${propertyName}!: ${propertyType} = ${uiDefault}`,
        explanation: `ä½¿ç”¨ UI ç»„ä»¶çš„æ ‡å‡†é»˜è®¤å€¼: ${uiDefault}`
      };
    }
    
    // ç­–ç•¥ 4: æ£€æŸ¥è¯­ä¹‰æ¨¡å¼åŒ¹é…ï¼ˆä¼˜å…ˆçº§ç¬¬ä¸‰ï¼‰
    for (const { pattern, defaultValue, type } of this.semanticPatterns) {
      if (pattern.test(propertyName)) {
        // æ£€æŸ¥ç±»å‹æ˜¯å¦åŒ¹é…
        if (this.isTypeCompatible(propertyType, type)) {
          return {
            strategy: 'semantic_default',
            syntax: `public var ${propertyName}!: ${propertyType} = ${defaultValue}`,
            explanation: `æ ¹æ®å±æ€§åè¯­ä¹‰æ¨æ–­çš„é»˜è®¤å€¼: ${defaultValue}`
          };
        }
      }
    }
    
    // ç­–ç•¥ 5: æ£€æŸ¥æ˜¯å¦ä¸ºå›è°ƒå‡½æ•°ç±»å‹
    if (this.isCallbackType(propertyType)) {
      return {
        strategy: 'callback_option',
        syntax: `${propertyName}: Option<${propertyType}>`,
        explanation: 'å›è°ƒå‡½æ•°ä½¿ç”¨ Option ç±»å‹ï¼Œå…è®¸ä¸ºç©º'
      };
    }
    
    // ç­–ç•¥ 6: æ£€æŸ¥æ˜¯å¦ä¸ºæšä¸¾æˆ–è”åˆç±»å‹
    if (this.isEnumOrUnionType(propertyType)) {
      const enumDefault = this.getEnumDefaultValue(propertyType);
      if (enumDefault) {
        return {
          strategy: 'enum_default',
          syntax: `public var ${propertyName}!: ${propertyType} = ${enumDefault}`,
          explanation: `æšä¸¾ç±»å‹ä½¿ç”¨é»˜è®¤å€¼: ${enumDefault}`
        };
      }
    }
    
    // ç­–ç•¥ 7: å›é€€åˆ° Option ç±»å‹ï¼ˆæœ€åçš„é€‰æ‹©ï¼‰
    return {
      strategy: 'option_type',
      syntax: `${propertyName}: Option<${propertyType}>`,
      explanation: 'æ— æ³•ç¡®å®šåˆé€‚çš„é»˜è®¤å€¼ï¼Œä½¿ç”¨ Option ç±»å‹è¡¨ç¤ºå¯é€‰'
    };
  }
  
  /**
   * ç”Ÿæˆä¾¿åˆ©æ–¹æ³•ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰
   * @param propertyName å±æ€§åç§°
   * @param propertyType å±æ€§ç±»å‹
   * @param componentName ç»„ä»¶åç§°
   * @returns ä¾¿åˆ©æ–¹æ³•ä»£ç è¡Œæ•°ç»„
   */
  generateConvenienceMethods(
    propertyName: string, 
    propertyType: string,
    componentName: string
  ): string[] {
    const methods: string[] = [];
    const capitalizedName = this.capitalize(propertyName);
    
    // ä¸º Option ç±»å‹çš„å±æ€§ç”Ÿæˆä¾¿åˆ©æ–¹æ³•
    methods.push(`  /**`);
    methods.push(`   * è®¾ç½® ${propertyName} å±æ€§`);
    methods.push(`   * @param value ${propertyName} çš„å€¼`);
    methods.push(`   * @returns å½“å‰ç»„ä»¶å®ä¾‹ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨`);
    methods.push(`   */`);
    methods.push(`  public func set${capitalizedName}(value: ${propertyType}): ${componentName} {`);
    methods.push(`    this.${propertyName} = Some(value)`);
    methods.push(`    return this`);
    methods.push(`  }`);
    methods.push(``);
    
    // ä¸º Option ç±»å‹ç”Ÿæˆæ¸…é™¤æ–¹æ³•
    methods.push(`  /**`);
    methods.push(`   * æ¸…é™¤ ${propertyName} å±æ€§ï¼ˆè®¾ä¸º Noneï¼‰`);
    methods.push(`   * @returns å½“å‰ç»„ä»¶å®ä¾‹ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨`);
    methods.push(`   */`);
    methods.push(`  public func clear${capitalizedName}(): ${componentName} {`);
    methods.push(`    this.${propertyName} = None`);
    methods.push(`    return this`);
    methods.push(`  }`);
    methods.push(``);
    
    // ä¸º Option ç±»å‹ç”Ÿæˆè®¾ç½®å¯é€‰å€¼çš„æ–¹æ³•
    methods.push(`  /**`);
    methods.push(`   * è®¾ç½® ${propertyName} çš„å¯é€‰å€¼`);
    methods.push(`   * @param value å¯é€‰çš„ ${propertyName} å€¼`);
    methods.push(`   * @returns å½“å‰ç»„ä»¶å®ä¾‹ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨`);
    methods.push(`   */`);
    methods.push(`  public func set${capitalizedName}Optional(value: Option<${propertyType}>): ${componentName} {`);
    methods.push(`    this.${propertyName} = value`);
    methods.push(`    return this`);
    methods.push(`  }`);
    
    return methods;
  }
  
  /**
   * æ£€æŸ¥ç±»å‹å…¼å®¹æ€§ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰
   * @param actualType å®é™…ç±»å‹
   * @param expectedType æœŸæœ›ç±»å‹
   * @returns æ˜¯å¦å…¼å®¹
   */
  private isTypeCompatible(actualType: string, expectedType: string): boolean {
    // ç®€å•çš„ç±»å‹å…¼å®¹æ€§æ£€æŸ¥
    if (actualType === expectedType) return true;
    
    // æ£€æŸ¥è¯­ä¹‰åŒ–ç±»å‹çš„å…¼å®¹æ€§ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰
    const typeCompatibilityMap: Record<string, string[]> = {
      'Length': ['Int64', 'Float64', 'number'],
      'Duration': ['Int64', 'Float64', 'number'],
      'String': ['string'],
      'ResourceStr': ['string', 'String'],
      'ResourceColor': ['string', 'String', 'Color'],
      'Bool': ['boolean'],
      'Int64': ['number', 'integer'],
      'Int32': ['number', 'integer'],
      'Float64': ['number', 'float']
    };
    
    const compatibleTypes = typeCompatibilityMap[expectedType];
    return compatibleTypes ? compatibleTypes.includes(actualType) : false;
  }
  
  /**
   * æ£€æŸ¥æ˜¯å¦ä¸ºå›è°ƒå‡½æ•°ç±»å‹
   * @param type ç±»å‹å­—ç¬¦ä¸²
   * @returns æ˜¯å¦ä¸ºå›è°ƒç±»å‹
   */
  private isCallbackType(type: string): boolean {
    return type.includes('->') || 
           type.includes('() =>') ||
           type.includes('Callback') ||
           type.includes('Handler') ||
           type.includes('Listener') ||
           type.startsWith('(') && type.includes(') =>');
  }
  
  /**
   * æ£€æŸ¥æ˜¯å¦ä¸ºæšä¸¾æˆ–è”åˆç±»å‹
   * @param type ç±»å‹å­—ç¬¦ä¸²
   * @returns æ˜¯å¦ä¸ºæšä¸¾æˆ–è”åˆç±»å‹
   */
  private isEnumOrUnionType(type: string): boolean {
    return type.includes('|') || 
           type.includes('Union_') ||
           /^[A-Z][a-zA-Z]*$/.test(type); // ç®€å•çš„æšä¸¾å‘½åæ£€æŸ¥
  }
  
  /**
   * è·å–æšä¸¾ç±»å‹çš„é»˜è®¤å€¼ï¼ˆåŸºäºä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ç³»ç»Ÿï¼‰
   * @param enumType æšä¸¾ç±»å‹åç§°
   * @returns é»˜è®¤å€¼æˆ– null
   */
  private getEnumDefaultValue(enumType: string): string | null {
    // å¸¸è§æšä¸¾ç±»å‹çš„é»˜è®¤å€¼æ˜ å°„ï¼ˆåŸºäºä»“é¢‰è¯­è¨€æšä¸¾ç±»å‹ç³»ç»Ÿï¼‰
    const enumDefaults: Record<string, string> = {
      'TextAlign': 'TextAlign.Start',
      'VerticalAlign': 'VerticalAlign.Top',
      'FontWeight': 'FontWeight.Normal',
      'FontStyle': 'FontStyle.Normal',
      'BorderStyle': 'BorderStyle.Solid',
      'FlexDirection': 'FlexDirection.Row',
      'JustifyContent': 'JustifyContent.Start',
      'AlignItems': 'AlignItems.Start',
      'Visibility': 'Visibility.Visible',
      'ScrollDirection': 'ScrollDirection.Vertical',
      'ImageFit': 'ImageFit.Cover',
      'BlendMode': 'BlendMode.Normal',
      'GestureDirection': 'GestureDirection.All',
      'HitTestBehavior': 'HitTestBehavior.Auto'
    };
    
    return enumDefaults[enumType] || null;
  }
  
  /**
   * é¦–å­—æ¯å¤§å†™
   * @param str è¾“å…¥å­—ç¬¦ä¸²
   * @returns é¦–å­—æ¯å¤§å†™çš„å­—ç¬¦ä¸²
   */
  private capitalize(str: string): string {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }
  
  /**
   * ç”Ÿæˆç­–ç•¥å†³ç­–æŠ¥å‘Š
   * @param decisions å†³ç­–æ•°ç»„
   * @returns å†³ç­–æŠ¥å‘Š
   */
  generateStrategyReport(decisions: OptionalHandlingStrategy[]): string[] {
    const report: string[] = [];
    
    report.push('// =====================================================');
    report.push('// å¯é€‰ç±»å‹å¤„ç†ç­–ç•¥æŠ¥å‘Šï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰');
    report.push('// =====================================================');
    report.push('');
    
    // ç»Ÿè®¡å„ç§ç­–ç•¥çš„ä½¿ç”¨æƒ…å†µ
    const strategyCount = decisions.reduce((acc, decision) => {
      acc[decision.strategy] = (acc[decision.strategy] || 0) + 1;
      return acc;
    }, {} as Record<string, number>);
    
    report.push('// ç­–ç•¥ä½¿ç”¨ç»Ÿè®¡:');
    Object.entries(strategyCount).forEach(([strategy, count]) => {
      report.push(`// - ${strategy}: ${count} ä¸ªå±æ€§`);
    });
    
    report.push('');
    report.push('// è¯¦ç»†å†³ç­–è®°å½•:');
    decisions.forEach((decision, index) => {
      report.push(`// ${index + 1}. ç­–ç•¥: ${decision.strategy}`);
      report.push(`//    è¯­æ³•: ${decision.syntax}`);
      report.push(`//    åŸå› : ${decision.explanation}`);
      report.push('');
    });
    
    return report;
  }
}

/**
 * å¯é€‰ç±»å‹å¤„ç†ç­–ç•¥æ¥å£
 */
interface OptionalHandlingStrategy {
  strategy: 'required' | 'explicit_default' | 'ui_default' | 'semantic_default' | 'callback_option' | 'enum_default' | 'option_type';
  syntax: string;
  explanation: string;
}

// åœ¨ CJDeclarationConvertor.ts ä¸­çš„ä½¿ç”¨ç¤ºä¾‹ï¼š
// æ–‡ä»¶ä½ç½®: arkgen/src/declaration/CJDeclarationConvertor.ts
// ä¿®æ”¹ä½ç½®: makeProperty() å‡½æ•°ï¼Œçº¦ç¬¬ 300-350 è¡Œ

/**
 * å¤„ç†å¯é€‰å±æ€§çš„è½¬æ¢ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿï¼‰
 * æ›¿æ¢åŸæœ‰çš„ç®€å•å¯é€‰å±æ€§å¤„ç†é€»è¾‘
 */
function convertOptionalProperty(
  propertyName: string,
  propertyType: string,
  isOptional: boolean,
  initializer?: ts.Expression
): string {
  // åˆ›å»ºæ¨æ–­å¼•æ“å®ä¾‹
  const inferenceEngine = new OptionalTypeInferenceEngine();
  
  // æ¨æ–­å¤„ç†ç­–ç•¥
  const strategy = inferenceEngine.inferOptionalHandling(
    propertyName,
    propertyType,
    !!initializer,  // æ˜¯å¦æœ‰åˆå§‹åŒ–å™¨
    !isOptional     // æ˜¯å¦ä¸ºå¿…éœ€å±æ€§
  );
  
  // è®°å½•ç­–ç•¥å†³ç­–ï¼ˆç”¨äºè°ƒè¯•å’ŒæŠ¥å‘Šï¼‰
  console.debug(`Optional property strategy: ${propertyName} -> ${strategy.strategy}`);
  console.debug(`  Syntax: ${strategy.syntax}`);
  console.debug(`  Reason: ${strategy.explanation}`);
  
  // è¿”å›ç”Ÿæˆçš„å±æ€§å£°æ˜
  return strategy.syntax;
}
```

</details>

### 4.2 å‡½æ•°ç±»å‹å‘½åæå–å®æ–½ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰

**å›è°ƒç±»å‹æå–å™¨ï¼š**

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹ä»£ç </summary>

```typescript
// æ–‡ä»¶ä½ç½®: arkgen/src/types/CallbackTypeExtractor.ts (æ–°å»ºæ–‡ä»¶)

/**
 * å›è°ƒç±»å‹æå–å™¨
 * è´Ÿè´£è¯†åˆ«ã€åˆ†æå’Œæå– TypeScript å‡½æ•°ç±»å‹ï¼Œç”Ÿæˆå¯¹åº”çš„ Cangjie å‘½åå›è°ƒç±»å‹
 */
class CallbackTypeExtractor {
  // å›è°ƒç±»å‹æ³¨å†Œè¡¨ - é¿å…é‡å¤ç”Ÿæˆç›¸åŒçš„å›è°ƒç±»å‹
  private callbackRegistry = new Map<string, string>();
  
  // å›è°ƒç±»å‹ä½¿ç”¨é¢‘æ¬¡ç»Ÿè®¡ - ç”¨äºä¼˜åŒ–å’ŒæŠ¥å‘Š
  private usageCount = new Map<string, number>();
  
  // å¸¸è§çš„å›è°ƒå±æ€§åæ¨¡å¼ - ç”¨äºç”Ÿæˆè¯­ä¹‰åŒ–çš„ç±»å‹åç§°
  private commonPatterns = [
    // onClick, onHover, onChange ç­‰æ ‡å‡†äº‹ä»¶å›è°ƒ
    { pattern: /^on[A-Z]\w*$/, suffix: 'Callback', category: 'event' },
    // xxxHandler åç¼€çš„å›è°ƒ
    { pattern: /\w+Handler$/, suffix: '', category: 'handler' },
    // xxxListener åç¼€çš„å›è°ƒ  
    { pattern: /\w+Listener$/, suffix: '', category: 'listener' },
    // xxxProcessor åç¼€çš„å›è°ƒ
    { pattern: /\w+Processor$/, suffix: '', category: 'processor' },
    // callback ç»“å°¾çš„å›è°ƒ
    { pattern: /\w+Callback$/, suffix: '', category: 'callback' },
    // åŠ¨ä½œç›¸å…³çš„å›è°ƒ (handle, process, execute ç­‰)
    { pattern: /^(handle|process|execute|perform)\w*$/, suffix: 'Action', category: 'action' }
  ];
  
  // æ ‡å‡†äº‹ä»¶ç±»å‹æ˜ å°„ - å°† TS äº‹ä»¶ç±»å‹æ˜ å°„ä¸º Cangjie äº‹ä»¶ç±»å‹
  private eventTypeMapping = new Map<string, string>([
    // é¼ æ ‡äº‹ä»¶æ˜ å°„
    ['MouseEvent', 'PointerEvent'],
    ['PointerEvent', 'PointerEvent'],
    ['TouchEvent', 'TouchEvent'],
    
    // é”®ç›˜äº‹ä»¶æ˜ å°„
    ['KeyboardEvent', 'KeyEvent'],
    ['KeyEvent', 'KeyEvent'],
    
    // UI äº‹ä»¶æ˜ å°„
    ['UIEvent', 'UIEvent'],
    ['Event', 'BaseEvent'],
    
    // è‡ªå®šä¹‰äº‹ä»¶æ˜ å°„
    ['ClickEvent', 'ClickEvent'],
    ['FocusEvent', 'FocusEvent'],
    ['ChangeEvent', 'ChangeEvent'],
    ['InputEvent', 'InputEvent'],
    ['ScrollEvent', 'ScrollEvent'],
    ['ResizeEvent', 'ResizeEvent'],
    
    // æ‹–æ‹½äº‹ä»¶æ˜ å°„
    ['DragEvent', 'DragEvent'],
    ['DropEvent', 'DropEvent'],
    
    // æ‰‹åŠ¿äº‹ä»¶æ˜ å°„
    ['GestureEvent', 'GestureEvent'],
    ['PanGestureEvent', 'PanGestureEvent'],
    ['TapGestureEvent', 'TapGestureEvent'],
    ['LongPressGestureEvent', 'LongPressGestureEvent'],
    ['PinchGestureEvent', 'PinchGestureEvent'],
    ['RotationGestureEvent', 'RotationGestureEvent'],
    ['SwipeGestureEvent', 'SwipeGestureEvent'],
  ]);
  
  /**
   * æå–å›è°ƒç±»å‹å®šä¹‰
   * @param functionSignature å‡½æ•°ç­¾åå­—ç¬¦ä¸²ï¼Œå¦‚ "(event: ClickEvent) => void"
   * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…å«å±æ€§åå’Œç»„ä»¶å
   * @returns æå–ç»“æœï¼ŒåŒ…å«ç±»å‹åã€å®šä¹‰å’Œæ˜¯å¦å¤ç”¨
   */
  extractCallbackType(
    functionSignature: string,
    context: { propertyName?: string; componentName?: string }
  ): CallbackExtraction {
    // è§£æå‡½æ•°ç­¾å
    const signature = this.parseFunctionSignature(functionSignature);
    
    // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒçš„å›è°ƒç±»å‹
    const existingType = this.callbackRegistry.get(signature.normalized);
    if (existingType) {
      // å¢åŠ ä½¿ç”¨è®¡æ•°
      this.usageCount.set(existingType, (this.usageCount.get(existingType) || 0) + 1);
      
      return {
        typeName: existingType,
        typeDefinition: null,  // å·²å­˜åœ¨ï¼Œä¸éœ€è¦é‡æ–°å®šä¹‰
        isReused: true
      };
    }
    
    // ç”Ÿæˆæ–°çš„å›è°ƒç±»å‹åç§°
    const typeName = this.generateCallbackTypeName(context.propertyName, signature, context.componentName);
    
    // æ³¨å†Œæ–°ç±»å‹åˆ°æ³¨å†Œè¡¨
    this.callbackRegistry.set(signature.normalized, typeName);
    this.usageCount.set(typeName, 1);
    
    return {
      typeName,
      typeDefinition: this.generateTypeDefinition(typeName, signature),
      isReused: false
    };
  }
  
  /**
   * è§£æå‡½æ•°ç­¾åå­—ç¬¦ä¸²
   * @param signature å‡½æ•°ç­¾åï¼Œå¦‚ "(event: ClickEvent) => void"
   * @returns è§£æåçš„ç­¾åå¯¹è±¡
   */
  private parseFunctionSignature(signature: string): ParsedSignature {
    // æ¸…ç†ç­¾åå­—ç¬¦ä¸²ï¼Œç§»é™¤å¤šä½™ç©ºæ ¼
    const cleanSignature = signature.trim();
    
    // åŒ¹é…ç®­å¤´å‡½æ•°æ ¼å¼: (param1: Type1, param2: Type2) => ReturnType
    const arrowMatch = cleanSignature.match(/\(([^)]*)\)\s*=>\s*(.+)/);
    if (arrowMatch) {
      const [, paramStr, returnType] = arrowMatch;
      const params = this.parseParameters(paramStr);
      
      return {
        params,
        returnType: this.normalizeReturnType(returnType.trim()),
        normalized: this.normalizeSignature(params, returnType.trim())
      };
    }
    
    // åŒ¹é…å‡½æ•°ç±»å‹æ ¼å¼: (param1: Type1, param2: Type2) -> ReturnType
    const functionMatch = cleanSignature.match(/\(([^)]*)\)\s*->\s*(.+)/);
    if (functionMatch) {
      const [, paramStr, returnType] = functionMatch;
      const params = this.parseParameters(paramStr);
      
      return {
        params,
        returnType: this.normalizeReturnType(returnType.trim()),
        normalized: this.normalizeSignature(params, returnType.trim())
      };
    }
    
    // å¦‚æœæ— æ³•è§£æï¼Œè¿”å›é»˜è®¤å€¼
    console.warn(`Unable to parse function signature: ${signature}`);
    return { 
      params: [], 
      returnType: 'Unit', 
      normalized: 'unknown_signature'
    };
  }
  
  /**
   * è§£æå‚æ•°åˆ—è¡¨å­—ç¬¦ä¸²
   * @param paramStr å‚æ•°å­—ç¬¦ä¸²ï¼Œå¦‚ "event: ClickEvent, data: string"
   * @returns è§£æåçš„å‚æ•°æ•°ç»„
   */
  private parseParameters(paramStr: string): Array<{ name: string; type: string }> {
    if (!paramStr.trim()) {
      return [];  // æ— å‚æ•°
    }
    
    const params: Array<{ name: string; type: string }> = [];
    
    // æŒ‰é€—å·åˆ†å‰²å‚æ•°ï¼Œä½†è¦è€ƒè™‘æ³›å‹ä¸­çš„é€—å·
    const paramParts = this.splitParameterString(paramStr);
    
    for (const part of paramParts) {
      const paramMatch = part.trim().match(/^([^:]+):\s*(.+)$/);
      if (paramMatch) {
        const [, name, type] = paramMatch;
        params.push({
          name: name.trim(),
          type: this.normalizeParameterType(type.trim())
        });
      } else {
        // å¦‚æœæ²¡æœ‰ç±»å‹æ³¨è§£ï¼Œé»˜è®¤ä¸º Any
        params.push({
          name: part.trim(),
          type: 'Any'
        });
      }
    }
    
    return params;
  }
  
  /**
   * æ™ºèƒ½åˆ†å‰²å‚æ•°å­—ç¬¦ä¸²ï¼Œè€ƒè™‘æ³›å‹å’ŒåµŒå¥—ç±»å‹
   * @param paramStr å‚æ•°å­—ç¬¦ä¸²
   * @returns åˆ†å‰²åçš„å‚æ•°éƒ¨åˆ†æ•°ç»„
   */
  private splitParameterString(paramStr: string): string[] {
    const parts: string[] = [];
    let current = '';
    let depth = 0;
    let inString = false;
    let stringChar = '';
    
    for (let i = 0; i < paramStr.length; i++) {
      const char = paramStr[i];
      
      // å¤„ç†å­—ç¬¦ä¸²å†…å®¹
      if (inString) {
        current += char;
        if (char === stringChar && paramStr[i - 1] !== '\\') {
          inString = false;
        }
        continue;
      }
      
      // æ£€æµ‹å­—ç¬¦ä¸²å¼€å§‹
      if (char === '"' || char === "'") {
        inString = true;
        stringChar = char;
        current += char;
        continue;
      }
      
      // å¤„ç†åµŒå¥—æ‹¬å·å’Œå°–æ‹¬å·
      if (char === '(' || char === '<' || char === '[') {
        depth++;
      } else if (char === ')' || char === '>' || char === ']') {
        depth--;
      }
      
      // åœ¨é¡¶å±‚é‡åˆ°é€—å·æ—¶åˆ†å‰²
      if (char === ',' && depth === 0) {
        parts.push(current.trim());
        current = '';
      } else {
        current += char;
      }
    }
    
    // æ·»åŠ æœ€åä¸€éƒ¨åˆ†
    if (current.trim()) {
      parts.push(current.trim());
    }
    
    return parts;
  }
  
  /**
   * è§„èŒƒåŒ–å‚æ•°ç±»å‹åç§°
   * @param type åŸå§‹ç±»å‹åç§°
   * @returns è§„èŒƒåŒ–åçš„ç±»å‹åç§°
   */
  private normalizeParameterType(type: string): string {
    // ç§»é™¤å¯é€‰æ ‡è®°
    const cleanType = type.replace(/\s*\|\s*undefined$/, '').replace(/\?$/, '');
    
    // åº”ç”¨äº‹ä»¶ç±»å‹æ˜ å°„
    const mappedType = this.eventTypeMapping.get(cleanType);
    if (mappedType) {
      return mappedType;
    }
    
    // å¤„ç†æ³›å‹ç±»å‹
    if (cleanType.includes('<')) {
      return this.normalizeGenericType(cleanType);
    }
    
    // å¤„ç†è”åˆç±»å‹
    if (cleanType.includes('|')) {
      return this.normalizeUnionType(cleanType);
    }
    
    // åŸºç¡€ç±»å‹æ˜ å°„
    const typeMapping: Record<string, string> = {
      'string': 'String',
      'number': 'Int64',  // æˆ–æ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹© Float64
      'boolean': 'Bool',
      'void': 'Unit',
      'any': 'Any',
      'unknown': 'Any',
      'object': 'HashMap<String, Any>'
    };
    
    return typeMapping[cleanType] || cleanType;
  }
  
  /**
   * è§„èŒƒåŒ–è¿”å›ç±»å‹
   * @param returnType åŸå§‹è¿”å›ç±»å‹
   * @returns è§„èŒƒåŒ–åçš„è¿”å›ç±»å‹
   */
  private normalizeReturnType(returnType: string): string {
    if (returnType === 'void') {
      return 'Unit';
    }
    
    return this.normalizeParameterType(returnType);
  }
  
  /**
   * å¤„ç†æ³›å‹ç±»å‹
   * @param type æ³›å‹ç±»å‹å­—ç¬¦ä¸²
   * @returns å¤„ç†åçš„ç±»å‹å­—ç¬¦ä¸²
   */
  private normalizeGenericType(type: string): string {
    // æš‚æ—¶ä¿æŒæ³›å‹ç±»å‹ä¸å˜ï¼Œåç»­å¯ä»¥æ·»åŠ æ›´å¤æ‚çš„å¤„ç†é€»è¾‘
    return type;
  }
  
  /**
   * å¤„ç†è”åˆç±»å‹
   * @param type è”åˆç±»å‹å­—ç¬¦ä¸²
   * @returns å¤„ç†åçš„ç±»å‹å­—ç¬¦ä¸²
   */
  private normalizeUnionType(type: string): string {
    // ç®€å•å¤„ç†ï¼šå¦‚æœåŒ…å« null æˆ– undefinedï¼Œè½¬æ¢ä¸º Option<T>
    if (type.includes('null') || type.includes('undefined')) {
      const nonNullType = type
        .split('|')
        .map(t => t.trim())
        .filter(t => t !== 'null' && t !== 'undefined')
        .join(' | ');
      
      if (nonNullType) {
        return `Option<${this.normalizeParameterType(nonNullType)}>`;
      }
    }
    
    // å…¶ä»–è”åˆç±»å‹æš‚æ—¶ä¿æŒä¸å˜
    return type;
  }
  
  /**
   * ç”Ÿæˆè§„èŒƒåŒ–çš„ç­¾åå­—ç¬¦ä¸²ï¼Œç”¨äºå»é‡
   * @param params å‚æ•°æ•°ç»„
   * @param returnType è¿”å›ç±»å‹
   * @returns è§„èŒƒåŒ–çš„ç­¾åå­—ç¬¦ä¸²
   */
  private normalizeSignature(params: Array<{ name: string; type: string }>, returnType: string): string {
    // æŒ‰ç±»å‹ç”Ÿæˆç­¾åï¼Œå¿½ç•¥å‚æ•°åï¼ˆå› ä¸ºå‚æ•°åä¸å½±å“ç±»å‹å…¼å®¹æ€§ï¼‰
    const paramTypes = params.map(p => p.type).join(',');
    return `(${paramTypes})->${returnType}`;
  }
  
  /**
   * ç”Ÿæˆå›è°ƒç±»å‹åç§°
   * @param propertyName å±æ€§åç§°
   * @param signature å‡½æ•°ç­¾å
   * @param componentName ç»„ä»¶åç§°
   * @returns ç”Ÿæˆçš„ç±»å‹åç§°
   */
  private generateCallbackTypeName(
    propertyName: string | undefined, 
    signature: ParsedSignature,
    componentName?: string
  ): string {
    // ç­–ç•¥1: åŸºäºå±æ€§åç”Ÿæˆï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
    if (propertyName) {
      for (const { pattern, suffix, category } of this.commonPatterns) {
        if (pattern.test(propertyName)) {
          let baseName = propertyName;
          
          // ç§»é™¤ "on" å‰ç¼€
          if (baseName.startsWith('on')) {
            baseName = baseName.substring(2);
          }
          
          // ç§»é™¤å·²æœ‰çš„åç¼€
          baseName = baseName.replace(/(Callback|Handler|Listener|Processor)$/, '');
          
          // æ·»åŠ é€‚å½“çš„åç¼€
          const finalSuffix = suffix || this.getSuffixByCategory(category);
          return `On${this.capitalize(baseName)}${finalSuffix}`;
        }
      }
      
      // å¦‚æœæ²¡æœ‰åŒ¹é…æ¨¡å¼ï¼Œä½¿ç”¨é€šç”¨æ ¼å¼
      let baseName = propertyName.replace(/^on/, '');
      baseName = baseName.replace(/(Callback|Handler|Listener)$/, '');
      return `On${this.capitalize(baseName)}Callback`;
    }
    
    // ç­–ç•¥2: åŸºäºå‚æ•°ç±»å‹ç”Ÿæˆ
    if (signature.params.length === 0) {
      return 'VoidCallback';
    }
    
    if (signature.params.length === 1) {
      const paramType = signature.params[0].type;
      const cleanParamType = paramType.replace(/Event$/, '');
      return `On${cleanParamType}Callback`;
    }
    
    // ç­–ç•¥3: åŸºäºç»„ä»¶åç”Ÿæˆï¼ˆå¦‚æœæä¾›äº†ç»„ä»¶åï¼‰
    if (componentName && signature.params.length > 0) {
      const firstParamType = signature.params[0].type.replace(/Event$/, '');
      return `${componentName}${firstParamType}Callback`;
    }
    
    // ç­–ç•¥4: é€šç”¨å›è°ƒåç§°
    if (signature.params.length <= 3) {
      return `Event${signature.params.length}Callback`;  // Event1Callback, Event2Callback ç­‰
    }
    
    return 'ComplexEventCallback';
  }
  
  /**
   * æ ¹æ®åˆ†ç±»è·å–åç¼€
   * @param category åˆ†ç±»
   * @returns å¯¹åº”çš„åç¼€
   */
  private getSuffixByCategory(category: string): string {
    const suffixMapping: Record<string, string> = {
      'event': 'Callback',
      'handler': 'Handler',
      'listener': 'Listener',
      'processor': 'Processor',
      'callback': 'Callback',
      'action': 'Action'
    };
    
    return suffixMapping[category] || 'Callback';
  }
  
  /**
   * ç”Ÿæˆç±»å‹å®šä¹‰å­—ç¬¦ä¸²
   * @param typeName ç±»å‹åç§°
   * @param signature å‡½æ•°ç­¾å
   * @returns ç±»å‹å®šä¹‰å­—ç¬¦ä¸²
   */
  private generateTypeDefinition(typeName: string, signature: ParsedSignature): string {
    // ç”Ÿæˆå‚æ•°åˆ—è¡¨
    const paramList = signature.params
      .map(p => `${p.name}: ${p.type}`)
      .join(', ');
    
    // ç”Ÿæˆå®Œæ•´çš„ç±»å‹å®šä¹‰
    const definition = `public type ${typeName} = (${paramList}) -> ${signature.returnType}`;
    
    return definition;
  }
  
  /**
   * ç”Ÿæˆç±»å‹å®šä¹‰çš„æ–‡æ¡£æ³¨é‡Š
   * @param typeName ç±»å‹åç§°
   * @param signature å‡½æ•°ç­¾å
   * @returns æ–‡æ¡£æ³¨é‡Šè¡Œæ•°ç»„
   */
  private generateTypeDocumentation(typeName: string, signature: ParsedSignature): string[] {
    const docs: string[] = [];
    
    docs.push(`/**`);
    docs.push(` * ${typeName} å›è°ƒç±»å‹`);
    
    if (signature.params.length > 0) {
      docs.push(` * `);
      signature.params.forEach(param => {
        docs.push(` * @param ${param.name} ${this.getParameterDescription(param.type)}`);
      });
    }
    
    if (signature.returnType !== 'Unit') {
      docs.push(` * @returns ${this.getReturnTypeDescription(signature.returnType)}`);
    }
    
    docs.push(` */`);
    
    return docs;
  }
  
  /**
   * è·å–å‚æ•°ç±»å‹çš„æè¿°
   * @param type å‚æ•°ç±»å‹
   * @returns ç±»å‹æè¿°
   */
  private getParameterDescription(type: string): string {
    const descriptions: Record<string, string> = {
      'PointerEvent': 'æŒ‡é’ˆäº‹ä»¶å¯¹è±¡',
      'TouchEvent': 'è§¦æ‘¸äº‹ä»¶å¯¹è±¡',
      'KeyEvent': 'é”®ç›˜äº‹ä»¶å¯¹è±¡',
      'ClickEvent': 'ç‚¹å‡»äº‹ä»¶å¯¹è±¡',
      'FocusEvent': 'ç„¦ç‚¹äº‹ä»¶å¯¹è±¡',
      'ChangeEvent': 'å˜åŒ–äº‹ä»¶å¯¹è±¡',
      'InputEvent': 'è¾“å…¥äº‹ä»¶å¯¹è±¡',
      'ScrollEvent': 'æ»šåŠ¨äº‹ä»¶å¯¹è±¡',
      'String': 'å­—ç¬¦ä¸²å€¼',
      'Int64': 'æ•´æ•°å€¼',
      'Float64': 'æµ®ç‚¹æ•°å€¼',
      'Bool': 'å¸ƒå°”å€¼',
      'Any': 'ä»»æ„ç±»å‹å€¼'
    };
    
    return descriptions[type] || `${type} ç±»å‹çš„å€¼`;
  }
  
  /**
   * è·å–è¿”å›ç±»å‹çš„æè¿°
   * @param type è¿”å›ç±»å‹
   * @returns ç±»å‹æè¿°
   */
  private getReturnTypeDescription(type: string): string {
    if (type === 'Unit') {
      return 'æ— è¿”å›å€¼';
    }
    
    return `è¿”å› ${type} ç±»å‹çš„å€¼`;
  }
  
  /**
   * ç”Ÿæˆå›è°ƒç±»å‹æ³¨å†Œè¡¨
   * @returns ç±»å‹å®šä¹‰å­—ç¬¦ä¸²æ•°ç»„
   */
  generateCallbackRegistry(): string[] {
    const definitions: string[] = [];
    
    // æ·»åŠ æ–‡ä»¶å¤´éƒ¨æ³¨é‡Š
    definitions.push('// =====================================================');
    definitions.push('// è‡ªåŠ¨ç”Ÿæˆçš„å›è°ƒç±»å‹å®šä¹‰');
    definitions.push('// æœ¬æ–‡ä»¶ç”± CallbackTypeExtractor è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹');
    definitions.push('// =====================================================');
    definitions.push('');
    
    // æ ‡å‡†å›è°ƒç±»å‹
    definitions.push('// æ ‡å‡†å›è°ƒç±»å‹');
    definitions.push('public type VoidCallback = () -> Unit');
    definitions.push('public type ValueCallback<T> = (T) -> Unit');
    definitions.push('public type BoolCallback = (Bool) -> Unit');
    definitions.push('public type StringCallback = (String) -> Unit');
    definitions.push('public type NumberCallback = (Int64) -> Unit');
    definitions.push('');
    
    // ç”Ÿæˆæ³¨å†Œè¡¨ä¸­çš„æ‰€æœ‰ç±»å‹å®šä¹‰
    definitions.push('// ç»„ä»¶ç‰¹å®šå›è°ƒç±»å‹');
    const uniqueDefinitions = Array.from(new Set(
      Array.from(this.callbackRegistry.values())
    ));
    
    for (const typeName of uniqueDefinitions) {
      // æŸ¥æ‰¾å¯¹åº”çš„ç­¾å
      const signature = this.findSignatureByTypeName(typeName);
      if (signature) {
        // æ·»åŠ æ–‡æ¡£æ³¨é‡Š
        const docs = this.generateTypeDocumentation(typeName, signature);
        definitions.push(...docs);
        
        // æ·»åŠ ç±»å‹å®šä¹‰
        const definition = this.generateTypeDefinition(typeName, signature);
        definitions.push(definition);
        definitions.push('');
      }
    }
    
    return definitions;
  }
  
  /**
   * æ ¹æ®ç±»å‹åç§°æŸ¥æ‰¾å¯¹åº”çš„ç­¾å
   * @param typeName ç±»å‹åç§°
   * @returns å¯¹åº”çš„ç­¾åæˆ– null
   */
  private findSignatureByTypeName(typeName: string): ParsedSignature | null {
    for (const [normalizedSig, registeredTypeName] of this.callbackRegistry) {
      if (registeredTypeName === typeName) {
        // è¿™é‡Œéœ€è¦åå‘è§£æï¼Œæš‚æ—¶è¿”å› null
        // åœ¨å®é™…å®ç°ä¸­ï¼Œåº”è¯¥ç»´æŠ¤ä¸€ä¸ªåå‘æ˜ å°„
        return null;
      }
    }
    return null;
  }
  
  /**
   * ç”Ÿæˆä½¿ç”¨ç»Ÿè®¡æŠ¥å‘Š
   * @returns ç»Ÿè®¡æŠ¥å‘Šå­—ç¬¦ä¸²æ•°ç»„
   */
  generateUsageReport(): string[] {
    const report: string[] = [];
    
    report.push('// å›è°ƒç±»å‹ä½¿ç”¨ç»Ÿè®¡æŠ¥å‘Š');
    report.push(`// æ€»è®¡ç”Ÿæˆå›è°ƒç±»å‹: ${this.callbackRegistry.size} ä¸ª`);
    report.push(`// æ€»è®¡ä½¿ç”¨æ¬¡æ•°: ${Array.from(this.usageCount.values()).reduce((a, b) => a + b, 0)} æ¬¡`);
    report.push('');
    
    // æŒ‰ä½¿ç”¨é¢‘æ¬¡æ’åº
    const sortedUsage = Array.from(this.usageCount.entries())
      .sort((a, b) => b[1] - a[1]);
    
    report.push('// ä½¿ç”¨é¢‘æ¬¡æ’è¡Œæ¦œ:');
    sortedUsage.slice(0, 10).forEach(([typeName, count], index) => {
      report.push(`// ${index + 1}. ${typeName}: ${count} æ¬¡`);
    });
    
    return report;
  }
  
  /**
   * é¦–å­—æ¯å¤§å†™
   * @param str è¾“å…¥å­—ç¬¦ä¸²
   * @returns é¦–å­—æ¯å¤§å†™çš„å­—ç¬¦ä¸²
   */
  private capitalize(str: string): string {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }
}

/**
 * å›è°ƒæå–ç»“æœæ¥å£
 */
interface CallbackExtraction {
  typeName: string;           // ç”Ÿæˆçš„ç±»å‹åç§°
  typeDefinition: string | null; // ç±»å‹å®šä¹‰ï¼ˆå¦‚æœæ˜¯æ–°ç±»å‹ï¼‰
  isReused: boolean;          // æ˜¯å¦å¤ç”¨äº†å·²å­˜åœ¨çš„ç±»å‹
}

/**
 * è§£æåçš„å‡½æ•°ç­¾åæ¥å£
 */
interface ParsedSignature {
  params: Array<{ name: string; type: string }>; // å‚æ•°åˆ—è¡¨
  returnType: string;         // è¿”å›ç±»å‹
  normalized: string;         // è§„èŒƒåŒ–çš„ç­¾åå­—ç¬¦ä¸²
}

// åœ¨ CJDeclarationConvertor.ts ä¸­çš„ä½¿ç”¨ç¤ºä¾‹ï¼š
// æ–‡ä»¶ä½ç½®: arkgen/src/declaration/CJDeclarationConvertor.ts
// ä¿®æ”¹ä½ç½®: convertType() å‡½æ•°ä¸­å¤„ç†å‡½æ•°ç±»å‹çš„éƒ¨åˆ†ï¼Œçº¦ç¬¬ 250-300 è¡Œ

/**
 * å¤„ç†å‡½æ•°ç±»å‹çš„è½¬æ¢
 * æ›¿æ¢åŸæœ‰çš„å†…è”å‡½æ•°ç±»å‹å¤„ç†é€»è¾‘
 */
function convertFunctionType(
  typeNode: ts.FunctionTypeNode | ts.TypeLiteralNode,
  propertyName?: string,
  componentName?: string
): string {
  // åˆ›å»ºå›è°ƒæå–å™¨å®ä¾‹
  const extractor = new CallbackTypeExtractor();
  
  // å°† TypeScript å‡½æ•°ç±»å‹èŠ‚ç‚¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç­¾å
  const functionSignature = typeNodeToString(typeNode);
  
  // æå–å›è°ƒç±»å‹
  const extraction = extractor.extractCallbackType(functionSignature, {
    propertyName,
    componentName
  });
  
  // å¦‚æœæ˜¯æ–°ç±»å‹ï¼Œéœ€è¦æ·»åŠ åˆ°ç±»å‹å®šä¹‰ä¸­
  if (!extraction.isReused && extraction.typeDefinition) {
    // å°†ç±»å‹å®šä¹‰æ·»åŠ åˆ°æ–‡ä»¶å¤´éƒ¨æˆ–ä¸“é—¨çš„ç±»å‹å®šä¹‰åŒºåŸŸ
    addTypeDefinition(extraction.typeDefinition);
  }
  
  // è®°å½•æå–ä¿¡æ¯ï¼ˆç”¨äºè°ƒè¯•å’ŒæŠ¥å‘Šï¼‰
  console.debug(`Callback type extraction: ${propertyName || 'anonymous'} -> ${extraction.typeName}`);
  if (extraction.isReused) {
    console.debug(`  Reused existing type: ${extraction.typeName}`);
  }
  
  // è¿”å›ç±»å‹åç§°
  return extraction.typeName;
}

/**
 * å°† TypeScript ç±»å‹èŠ‚ç‚¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç­¾å
 * @param typeNode TypeScript ç±»å‹èŠ‚ç‚¹
 * @returns å‡½æ•°ç­¾åå­—ç¬¦ä¸²
 */
function typeNodeToString(typeNode: ts.TypeNode): string {
  // è¿™é‡Œéœ€è¦å®ç°å°† TS ç±»å‹èŠ‚ç‚¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„é€»è¾‘
  // å¯ä»¥ä½¿ç”¨ TypeScript ç¼–è¯‘å™¨ API æˆ–æ‰‹åŠ¨æ„å»º
  return ''; // å®é™…å®ç°éœ€è¦å®Œå–„
}

/**
 * æ·»åŠ ç±»å‹å®šä¹‰åˆ°è¾“å‡º
 * @param typeDefinition ç±»å‹å®šä¹‰å­—ç¬¦ä¸²
 */
function addTypeDefinition(typeDefinition: string): void {
  // å°†ç±»å‹å®šä¹‰æ·»åŠ åˆ°å½“å‰ç”Ÿæˆæ–‡ä»¶çš„ç±»å‹å®šä¹‰åŒºåŸŸ
  // å…·ä½“å®ç°å–å†³äºä»£ç ç”Ÿæˆå™¨çš„æ¶æ„
}
```

</details>

### 4.3 å·¥å…·ç±»å‹å±•å¼€å®æ–½ï¼ˆåŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿï¼‰

**å·¥å…·ç±»å‹é¢„å¤„ç†å™¨ï¼š**

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ UtilityTypeFlattener ç±»å®ç°ä»£ç </summary>

```typescript
class UtilityTypeFlattener {
  flatten(node: ts.TypeNode, typeChecker: ts.TypeChecker): ts.TypeNode | null {
    if (!ts.isTypeReferenceNode(node)) {
      return node;
    }
    
    const typeName = node.typeName.getText();
    
    switch (typeName) {
      case 'Partial':
        return this.flattenPartial(node, typeChecker);
      case 'Pick':
        return this.flattenPick(node, typeChecker);
      case 'Omit':
        return this.flattenOmit(node, typeChecker);
      case 'Record':
        return this.flattenRecord(node, typeChecker);
      default:
        return node;
    }
  }
  
  private flattenPartial(
    node: ts.TypeReferenceNode, 
    typeChecker: ts.TypeChecker
  ): ts.TypeLiteralNode {
    const targetType = node.typeArguments?.[0];
    if (!targetType) return null;
    
    const members = this.getTypeMembers(targetType, typeChecker);
    const optionalMembers = members.map(member => ({
      ...member,
      optional: true
    }));
    
    return this.createTypeLiteral(optionalMembers);
  }
  
  private flattenPick(
    node: ts.TypeReferenceNode,
    typeChecker: ts.TypeChecker  
  ): ts.TypeLiteralNode {
    const [targetType, keysType] = node.typeArguments || [];
    if (!targetType || !keysType) return null;
    
    const allMembers = this.getTypeMembers(targetType, typeChecker);
    const pickKeys = this.extractLiteralKeys(keysType);
    
    const pickedMembers = allMembers.filter(member => 
      pickKeys.includes(member.name)
    );
    
    return this.createTypeLiteral(pickedMembers);
  }
  
  private flattenOmit(
    node: ts.TypeReferenceNode,
    typeChecker: ts.TypeChecker
  ): ts.TypeLiteralNode {
    const [targetType, keysType] = node.typeArguments || [];
    if (!targetType || !keysType) return null;
    
    const allMembers = this.getTypeMembers(targetType, typeChecker);
    const omitKeys = this.extractLiteralKeys(keysType);
    
    const remainingMembers = allMembers.filter(member => 
      !omitKeys.includes(member.name)
    );
    
    return this.createTypeLiteral(remainingMembers);
  }
  
  private flattenRecord(
    node: ts.TypeReferenceNode,
    typeChecker: ts.TypeChecker
  ): ts.TypeLiteralNode {
    const [keysType, valueType] = node.typeArguments || [];
    if (!keysType || !valueType) return null;
    
    // Record<K, V> -> ç´¢å¼•ç­¾å
    return this.createIndexSignatureType(keysType, valueType);
  }
  
  generateExpandedInterface(
    originalName: string, 
    utilityType: string,
    expandedMembers: TypeMember[]
  ): string {
    const interfaceName = `${originalName}${utilityType}`;
    
    const members = expandedMembers.map(member => {
      const optional = member.optional ? '?' : '';
      return `  ${member.name}${optional}: ${member.type};`;
    }).join('\n');
    
    return `interface ${interfaceName} {\n${members}\n}`;
  }
}

interface TypeMember {
  name: string;
  type: string;
  optional: boolean;
}
```

</details>

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

**ç‰ˆæœ¬**: v1.1  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ  
**è´Ÿè´£äºº**: dts2peer å¼€å‘å›¢é˜Ÿ  
**ä¼˜åŒ–é‡ç‚¹**: åŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿçš„å¤æ‚ç±»å‹å¤„ç†ä¼˜åŒ–  
**æ–‡æ¡£çŠ¶æ€**: å®Œæ•´ä¼˜åŒ–ï¼ŒåŒ…å«å®æ–½æŒ‡å—å’Œæœ€ä½³å®è·µ

## ğŸ¯ ä¸»è¦ä¼˜åŒ–å†…å®¹

**1. ä»“é¢‰è¯­è¨€ Option<T> ç±»å‹ç³»ç»Ÿæ·±å…¥ç†è§£**
- âœ… å……åˆ†åˆ©ç”¨ `Option<T>` ç±»å‹ç³»ç»Ÿï¼Œæ­£ç¡®å¤„ç†å¯é€‰å±æ€§
- âœ… æ™ºèƒ½é»˜è®¤å€¼æ¨æ–­ï¼ŒåŸºäºå±æ€§è¯­ä¹‰é€‰æ‹©åˆé€‚çš„å¤„ç†ç­–ç•¥
- âœ… åŸºäºä»“é¢‰è¯­è¨€ç»„ä»¶å£°æ˜çš„å®é™…ä½¿ç”¨æ¨¡å¼è¿›è¡Œç²¾ç¡®æ˜ å°„

**2. å›è°ƒç±»å‹å‘½ååŒ–ä¼˜åŒ–**
- âœ… ä½¿ç”¨è¯­ä¹‰åŒ–çš„å‘½åå›è°ƒç±»å‹ï¼Œæé«˜ä»£ç å¯è¯»æ€§
- âœ… å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ç±»å‹ç³»ç»Ÿè¿›è¡Œå‘½ååŒ–å¤„ç†
- âœ… ç±»å‹å¤ç”¨ï¼Œå‡å°‘é‡å¤å®šä¹‰

**3. æ³›å‹çº¦æŸæ”¯æŒä¼˜åŒ–**
- âœ… å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ `where` è¯­æ³•è¿›è¡Œæ³›å‹çº¦æŸ
- âœ… æ”¯æŒå¤æ‚çš„æ³›å‹çº¦æŸå…³ç³»
- âœ… ç±»å‹å®‰å…¨çš„æ³›å‹å¤„ç†

**4. é«˜çº§ç±»å‹å±•å¼€ä¼˜åŒ–**
- âœ… å°†å¤æ‚çš„é«˜çº§ç±»å‹æ™ºèƒ½å±•å¼€ä¸ºåŸºç¡€ç±»å‹ç»„åˆ
- âœ… åŸºäºä»“é¢‰è¯­è¨€ç±»å‹ç³»ç»Ÿè¿›è¡Œè¯­ä¹‰åŒ–å±•å¼€
- âœ… æä¾›ç±»å‹å®‰å…¨çš„é«˜çº§ç±»å‹å¤„ç†

**5. å¤æ‚ç±»å‹ç»„åˆå¤„ç†ä¼˜åŒ–**
- âœ… ä½¿ç”¨ä»“é¢‰è¯­è¨€çš„æšä¸¾ç±»å‹ç³»ç»Ÿå¤„ç†å­—é¢é‡è”åˆç±»å‹
- âœ… æ‰å¹³åŒ–å¤„ç†ï¼Œå°†åµŒå¥—å¯¹è±¡è½¬æ¢ä¸ºè¯­ä¹‰åŒ–ç±»å‹
- âœ… å……åˆ†åˆ©ç”¨ä»“é¢‰è¯­è¨€çš„ç±»å‹ç³»ç»Ÿä¼˜åŠ¿

## ğŸ“Š é¢„æœŸæ”¹è¿›æ•ˆæœ

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æ”¹è¿›å¹…åº¦ |
|------|--------|--------|----------|
| **ç±»å‹å¤æ‚åº¦** | é«˜ | ä½ | é™ä½ 70%+ |
| **ç¼–è¯‘æ—¶é—´** | æ…¢ | å¿« | æå‡ 50%+ |
| **ä»£ç å¯è¯»æ€§** | å·® | å¥½ | æ˜¾è‘—æå‡ |
| **ç±»å‹å®‰å…¨æ€§** | ä¸€èˆ¬ | é«˜ | æ˜¾è‘—æå‡ |
| **Option ç±»å‹ä½¿ç”¨** | æ—  | å…¨é¢ | 100% è¦†ç›– |
| **æšä¸¾ç±»å‹ä½¿ç”¨** | æ—  | å…¨é¢ | 100% è¦†ç›– |

